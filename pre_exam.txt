Wed Dec 18 04:12:47 PM EET 2024
+ hostname
archmachine
+ ansible-playbook infra.yaml --diff

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : get variables] ****************************************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [init : Update APT Cache] *************************************************
changed: [7uu13-1]
changed: [7uu13-2]
changed: [7uu13-3]

TASK [init : Add user named Juri] **********************************************
changed: [7uu13-2]
changed: [7uu13-1]
changed: [7uu13-3]

TASK [init : Add user named Roman] *********************************************
changed: [7uu13-3]
changed: [7uu13-2]
changed: [7uu13-1]

TASK [init : Add ssh key for user Juri] ****************************************
--- before: /home/juri/.ssh/authorized_keys
+++ after: /home/juri/.ssh/authorized_keys
@@ -0,0 +1,2 @@
+ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGdFB7fgAaw0Mk76b1veUE7K6Bib9MNqLQXTev8kIZpi 
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDDxR26gZ5PBGIxYsB2UAkS+W0bc5uPZn9akB+5ystYbQRKUL/j7bezMDvDuIaeryDDY//1r0nAwAd765lMgQ7VWa2Muzp3ROpv0CNFBO6Ol4mQ/wy46ZEZYKeA7NY8xY4dyFf6Sur1QHhaN1KKSYhvnmas0vgO8327wNi3SV52771nwV0CgMOzn4PnenakMM+ScRGRnamGDzLrjlNGqeq90KfXRQpOW7TZW/pprDbYUrD8Y1gr3kz0SkjclB6ao6HvbtesGjwuslfIumIw+RkWIJbfAJpiUm7RDmrahpwdwNyRYDsu0av9KBqAM3iDlZ5YOG9YMV+IrRiPr1jA4XyZsf2zhkx/WIL1Cp1BBtPF6aY9N9QJMF67u2RnNNKUz7tsfm7Yl7VPClrW+q+CGfiHu4LyRjBvIp4c7yFIxIP+fs4HA2ob4cNIatYWistytvDAw13EV9LBX/bN0Elb02egNbqI1JDaiGwr+YFFg67Ja8BAQt63VWZh5Nog8NE6sJs= 

changed: [7uu13-2]
--- before: /home/juri/.ssh/authorized_keys
+++ after: /home/juri/.ssh/authorized_keys
@@ -0,0 +1,2 @@
+ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGdFB7fgAaw0Mk76b1veUE7K6Bib9MNqLQXTev8kIZpi 
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDDxR26gZ5PBGIxYsB2UAkS+W0bc5uPZn9akB+5ystYbQRKUL/j7bezMDvDuIaeryDDY//1r0nAwAd765lMgQ7VWa2Muzp3ROpv0CNFBO6Ol4mQ/wy46ZEZYKeA7NY8xY4dyFf6Sur1QHhaN1KKSYhvnmas0vgO8327wNi3SV52771nwV0CgMOzn4PnenakMM+ScRGRnamGDzLrjlNGqeq90KfXRQpOW7TZW/pprDbYUrD8Y1gr3kz0SkjclB6ao6HvbtesGjwuslfIumIw+RkWIJbfAJpiUm7RDmrahpwdwNyRYDsu0av9KBqAM3iDlZ5YOG9YMV+IrRiPr1jA4XyZsf2zhkx/WIL1Cp1BBtPF6aY9N9QJMF67u2RnNNKUz7tsfm7Yl7VPClrW+q+CGfiHu4LyRjBvIp4c7yFIxIP+fs4HA2ob4cNIatYWistytvDAw13EV9LBX/bN0Elb02egNbqI1JDaiGwr+YFFg67Ja8BAQt63VWZh5Nog8NE6sJs= 

changed: [7uu13-3]
--- before: /home/juri/.ssh/authorized_keys
+++ after: /home/juri/.ssh/authorized_keys
@@ -0,0 +1,2 @@
+ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIGdFB7fgAaw0Mk76b1veUE7K6Bib9MNqLQXTev8kIZpi 
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAABgQDDxR26gZ5PBGIxYsB2UAkS+W0bc5uPZn9akB+5ystYbQRKUL/j7bezMDvDuIaeryDDY//1r0nAwAd765lMgQ7VWa2Muzp3ROpv0CNFBO6Ol4mQ/wy46ZEZYKeA7NY8xY4dyFf6Sur1QHhaN1KKSYhvnmas0vgO8327wNi3SV52771nwV0CgMOzn4PnenakMM+ScRGRnamGDzLrjlNGqeq90KfXRQpOW7TZW/pprDbYUrD8Y1gr3kz0SkjclB6ao6HvbtesGjwuslfIumIw+RkWIJbfAJpiUm7RDmrahpwdwNyRYDsu0av9KBqAM3iDlZ5YOG9YMV+IrRiPr1jA4XyZsf2zhkx/WIL1Cp1BBtPF6aY9N9QJMF67u2RnNNKUz7tsfm7Yl7VPClrW+q+CGfiHu4LyRjBvIp4c7yFIxIP+fs4HA2ob4cNIatYWistytvDAw13EV9LBX/bN0Elb02egNbqI1JDaiGwr+YFFg67Ja8BAQt63VWZh5Nog8NE6sJs= 

changed: [7uu13-1]

TASK [init : Add ssh key for user Roman] ***************************************
--- before: /home/roman/.ssh/authorized_keys
+++ after: /home/roman/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFligqCTgPl8lcKVsgHq9K9zEelCfTP+hcuG9tdhHgBoHwlZPilvTmi4veyORSGTuS9x8XwJuDAnAZsT75TFQVbOjp0XqqcpV/jF4ix6mS6kmdJzzruAaYSI6FWit4ZeRz8/XfNOmg2xaPn3A6hWAUAOhpeOiXtKcSZVOIitJOirjjYrK5Sq+cW8pFGjVWpweU46WwKYoPr1EyEN1PqUjDTOU4LvShEK1TF/kZOeRMysPf9lz1JQO6BKEr0oRWaROCMZwuTDlmh9i0LZEwje6e5ADxMyTHp9fgpCV9a4hDOE7EQdmePDtDO9PHjGQD3m060ydOiFbjSI98q0puzEKxpfzcyMEb/ztdiLWOBO5ANOMzADZ9f+D0S3bqHbSlq/pHXJ2aF2DfROKOrIg1ABFcgz4ugaGhQzYmxsKc2SXgzk/D7952k+FP5FxvW5FpX+xgkMGkt2XlLzjpvZO5eH/rHDppO1v+Pr876di5NbiXCC0GL3C80H2dl4QIrpeDtlFIO5spVtMqFBbUcXticNC9C6dXjOL5p5jhLq82tKHlc5Mnx0cyPRHeO8XCkA0MsipMOGy+tIiOPKaO/dDMT7kiYZKYvaNaUrmdB0MISydE8kTknHBVX9b/qOOysHglMJgmfIYP2YWXDVQFWq9hkWFVIS+yPiaEViphRKbTZMBbLQ== 

changed: [7uu13-2]
--- before: /home/roman/.ssh/authorized_keys
+++ after: /home/roman/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFligqCTgPl8lcKVsgHq9K9zEelCfTP+hcuG9tdhHgBoHwlZPilvTmi4veyORSGTuS9x8XwJuDAnAZsT75TFQVbOjp0XqqcpV/jF4ix6mS6kmdJzzruAaYSI6FWit4ZeRz8/XfNOmg2xaPn3A6hWAUAOhpeOiXtKcSZVOIitJOirjjYrK5Sq+cW8pFGjVWpweU46WwKYoPr1EyEN1PqUjDTOU4LvShEK1TF/kZOeRMysPf9lz1JQO6BKEr0oRWaROCMZwuTDlmh9i0LZEwje6e5ADxMyTHp9fgpCV9a4hDOE7EQdmePDtDO9PHjGQD3m060ydOiFbjSI98q0puzEKxpfzcyMEb/ztdiLWOBO5ANOMzADZ9f+D0S3bqHbSlq/pHXJ2aF2DfROKOrIg1ABFcgz4ugaGhQzYmxsKc2SXgzk/D7952k+FP5FxvW5FpX+xgkMGkt2XlLzjpvZO5eH/rHDppO1v+Pr876di5NbiXCC0GL3C80H2dl4QIrpeDtlFIO5spVtMqFBbUcXticNC9C6dXjOL5p5jhLq82tKHlc5Mnx0cyPRHeO8XCkA0MsipMOGy+tIiOPKaO/dDMT7kiYZKYvaNaUrmdB0MISydE8kTknHBVX9b/qOOysHglMJgmfIYP2YWXDVQFWq9hkWFVIS+yPiaEViphRKbTZMBbLQ== 

changed: [7uu13-3]
--- before: /home/roman/.ssh/authorized_keys
+++ after: /home/roman/.ssh/authorized_keys
@@ -0,0 +1 @@
+ssh-rsa AAAAB3NzaC1yc2EAAAADAQABAAACAQDFligqCTgPl8lcKVsgHq9K9zEelCfTP+hcuG9tdhHgBoHwlZPilvTmi4veyORSGTuS9x8XwJuDAnAZsT75TFQVbOjp0XqqcpV/jF4ix6mS6kmdJzzruAaYSI6FWit4ZeRz8/XfNOmg2xaPn3A6hWAUAOhpeOiXtKcSZVOIitJOirjjYrK5Sq+cW8pFGjVWpweU46WwKYoPr1EyEN1PqUjDTOU4LvShEK1TF/kZOeRMysPf9lz1JQO6BKEr0oRWaROCMZwuTDlmh9i0LZEwje6e5ADxMyTHp9fgpCV9a4hDOE7EQdmePDtDO9PHjGQD3m060ydOiFbjSI98q0puzEKxpfzcyMEb/ztdiLWOBO5ANOMzADZ9f+D0S3bqHbSlq/pHXJ2aF2DfROKOrIg1ABFcgz4ugaGhQzYmxsKc2SXgzk/D7952k+FP5FxvW5FpX+xgkMGkt2XlLzjpvZO5eH/rHDppO1v+Pr876di5NbiXCC0GL3C80H2dl4QIrpeDtlFIO5spVtMqFBbUcXticNC9C6dXjOL5p5jhLq82tKHlc5Mnx0cyPRHeO8XCkA0MsipMOGy+tIiOPKaO/dDMT7kiYZKYvaNaUrmdB0MISydE8kTknHBVX9b/qOOysHglMJgmfIYP2YWXDVQFWq9hkWFVIS+yPiaEViphRKbTZMBbLQ== 

changed: [7uu13-1]

TASK [init : install Nginx node exporter] **************************************
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 132 not upgraded.
changed: [7uu13-1]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 132 not upgraded.
changed: [7uu13-3]
The following additional packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter-collectors smartmontools
Suggested packages:
  gsmartcontrol smart-notifier mailx | mailutils
The following NEW packages will be installed:
  libio-pty-perl libipc-run-perl libtime-duration-perl libtimedate-perl
  moreutils prometheus-node-exporter prometheus-node-exporter-collectors
  smartmontools
0 upgraded, 8 newly installed, 0 to remove and 132 not upgraded.
changed: [7uu13-2]

TASK [init : Configure rsyslog] ************************************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpk0g909wm/50-telegraf.conf.j2
@@ -0,0 +1,10 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# forward over tcp with octet framing according to RFC 5425
+#*.* @@(o)127.0.0.1:6514;RSYSLOG_SyslogProtocol23Format
+
+# uncomment to use udp according to RFC 5424
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format

changed: [7uu13-1]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpdiddxo0d/50-telegraf.conf.j2
@@ -0,0 +1,10 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# forward over tcp with octet framing according to RFC 5425
+#*.* @@(o)127.0.0.1:6514;RSYSLOG_SyslogProtocol23Format
+
+# uncomment to use udp according to RFC 5424
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format

changed: [7uu13-3]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpmgewfqum/50-telegraf.conf.j2
@@ -0,0 +1,10 @@
+$ActionQueueType LinkedList # use asynchronous processing
+$ActionQueueFileName srvrfwd # set file name, also enables disk mode
+$ActionResumeRetryCount -1 # infinite retries on insert failure
+$ActionQueueSaveOnShutdown on # save in-memory data if rsyslog shuts down
+
+# forward over tcp with octet framing according to RFC 5425
+#*.* @@(o)127.0.0.1:6514;RSYSLOG_SyslogProtocol23Format
+
+# uncomment to use udp according to RFC 5424
+*.* @influxdb:6514;RSYSLOG_SyslogProtocol23Format

changed: [7uu13-2]

TASK [init : Ensure influx and telegraf are enabled and running] ***************
ok: [7uu13-1] => (item=prometheus-node-exporter)
ok: [7uu13-2] => (item=prometheus-node-exporter)
ok: [7uu13-3] => (item=prometheus-node-exporter)
ok: [7uu13-1] => (item=rsyslog)
ok: [7uu13-2] => (item=rsyslog)
ok: [7uu13-3] => (item=rsyslog)

TASK [init : Add user named backup] ********************************************
changed: [7uu13-1]
changed: [7uu13-3]
changed: [7uu13-2]

TASK [init : Configure known_hosts file] ***************************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpe70iz_8j/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.lockbox.sec ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [7uu13-1]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpbw3yckas/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.lockbox.sec ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [7uu13-2]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpzyv3rc6f/known_hosts.j2
@@ -0,0 +1,3 @@
+192.168.42.132 ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90
+backup.lockbox.sec ssh-ed25519 AAAAC3NzaC1lZDI1NTE5AAAAIEu6pFFWyuRrl4WGFPQGElYN9txwTGm2wSntcpVAaN90

changed: [7uu13-3]

TASK [init : Create a restore directory] ***************************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-1]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/restore",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-3]

TASK [init : Install duplicity] ************************************************
The following additional packages will be installed:
  librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python-nacl-doc python3-gssapi
  python3-invoke
The following NEW packages will be installed:
  duplicity librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 132 not upgraded.
changed: [7uu13-3]
The following additional packages will be installed:
  librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python-nacl-doc python3-gssapi
  python3-invoke
The following NEW packages will be installed:
  duplicity librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 132 not upgraded.
changed: [7uu13-2]
The following additional packages will be installed:
  librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
Suggested packages:
  python3-boto ncftp lftp tahoe-lafs python3-swiftclient python3-pip par2
  python-future-doc python-lockfile-doc python-nacl-doc python3-gssapi
  python3-invoke
The following NEW packages will be installed:
  duplicity librsync2 python3-fasteners python3-future python3-lockfile
  python3-monotonic python3-nacl python3-paramiko
0 upgraded, 8 newly installed, 0 to remove and 132 not upgraded.
changed: [7uu13-1]

RUNNING HANDLER [init : Restart rsyslog] ***************************************
changed: [7uu13-2]
changed: [7uu13-3]
changed: [7uu13-1]

PLAY [DNS Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [bind : Gather facts] *****************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [bind : Install bind9] ****************************************************
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
  python3-requests-toolbelt
Suggested packages:
  bind-doc resolvconf python3-sniffio python3-trio
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-requests-toolbelt
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 5 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
  python3-requests-toolbelt
Suggested packages:
  bind-doc resolvconf python3-sniffio python3-trio
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-requests-toolbelt
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 5 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-3]
The following additional packages will be installed:
  bind9-dnsutils bind9-host bind9-libs bind9-utils dns-root-data
  python3-requests-toolbelt
Suggested packages:
  bind-doc resolvconf python3-sniffio python3-trio
The following NEW packages will be installed:
  bind9 bind9-utils dns-root-data python3-dnspython python3-requests-toolbelt
The following packages will be upgraded:
  bind9-dnsutils bind9-host bind9-libs
3 upgraded, 5 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]

TASK [bind : Configure Bind9] **************************************************
changed: [7uu13-1] => (item=None)
changed: [7uu13-3] => (item=None)
changed: [7uu13-2] => (item=None)
changed: [7uu13-2] => (item=None)
changed: [7uu13-2]
changed: [7uu13-3] => (item=None)
changed: [7uu13-3]
changed: [7uu13-1] => (item=None)
changed: [7uu13-1]

TASK [bind : Configure DNS Master and Reverse Zone] ****************************
skipping: [7uu13-1] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'}) 
skipping: [7uu13-1] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'}) 
skipping: [7uu13-1]
skipping: [7uu13-2] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'}) 
skipping: [7uu13-2] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'}) 
skipping: [7uu13-2]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpi5uu8819/db.lockbox.sec.j2
@@ -0,0 +1,18 @@
+$TTL	604800
+lockbox.sec. 	IN	SOA	7uu13-3.lockbox.sec. tuule.lockbox.sec. (
+			      2		; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+
+lockbox.sec.	IN	NS	7uu13-3
+lockbox.sec.	IN	NS	7uu13-1
+lockbox.sec.	IN	NS	7uu13-2
+
+; A Records
+
+7uu13-3	IN	A	192.168.43.146
+7uu13-1	IN	A	192.168.43.57
+7uu13-2	IN	A	192.168.43.100

changed: [7uu13-3] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'})
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpe6v_1dkq/db.lockbox.sec.rev.j2
@@ -0,0 +1,16 @@
+$TTL	604800
+168.192.in-addr.arpa. 	IN	SOA	7uu13-3.lockbox.sec. tuule.lockbox.sec. (
+			      2		; Serial
+			 604800		; Refresh
+			  86400		; Retry
+			2419200		; Expire
+			 604800 )	; Negative Cache TTL
+;
+
+168.192.in-addr.arpa.	IN	NS	7uu13-3.lockbox.sec.
+168.192.in-addr.arpa.	IN	NS	7uu13-1.lockbox.sec.
+168.192.in-addr.arpa.	IN	NS	7uu13-2.lockbox.sec.
+
+57.43 IN PTR 7uu13-1.lockbox.sec.
+100.43 IN PTR 7uu13-2.lockbox.sec.
+146.43 IN PTR 7uu13-3.lockbox.sec.

changed: [7uu13-3] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'})

TASK [bind : Ensure bind9 service is started and enabled] **********************
ok: [7uu13-3]
ok: [7uu13-2]
ok: [7uu13-1]

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Flush handlers] ***************************************************

RUNNING HANDLER [bind : Restart Bind9 Service] *********************************
changed: [7uu13-3]
changed: [7uu13-1]
changed: [7uu13-2]

RUNNING HANDLER [bind : Reload rncd] *******************************************
changed: [7uu13-3]

TASK [bind : Add A Records] ****************************************************
skipping: [7uu13-1] => (item=None) 
skipping: [7uu13-1]
skipping: [7uu13-2] => (item=None) 
skipping: [7uu13-2]
changed: [7uu13-3] => (item=None)
changed: [7uu13-3]

TASK [Add both Slave Bind CNAME records] ***************************************
included: dns_record for 7uu13-3, 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-3]
changed: [7uu13-2]
changed: [7uu13-1]

TASK [bind : Download Bind9 exporter archive] **********************************
changed: [7uu13-2]
changed: [7uu13-1]
changed: [7uu13-3]

TASK [bind : Extract Bind9 exporter archive] ***********************************
changed: [7uu13-3]
changed: [7uu13-2]
changed: [7uu13-1]

TASK [bind : Create symbolic link to prometheus-bind-exporter] *****************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/usr/local/bin/bind_exporter",
-    "state": "absent"
+    "state": "link"
 }

changed: [7uu13-3]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/usr/local/bin/bind_exporter",
-    "state": "absent"
+    "state": "link"
 }

changed: [7uu13-2]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/usr/local/bin/bind_exporter",
-    "state": "absent"
+    "state": "link"
 }

changed: [7uu13-1]

TASK [bind : Create systemd service definition] ********************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpq_tbqoez/bind_exporter.service.j2
@@ -0,0 +1,10 @@
+[Unit]
+Description=Prometheus exporter for Bind
+
+[Service]
+Restart=on-failure
+User=prometheus
+ExecStart=/usr/local/bin/bind_exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [7uu13-3]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpkl006vgb/bind_exporter.service.j2
@@ -0,0 +1,10 @@
+[Unit]
+Description=Prometheus exporter for Bind
+
+[Service]
+Restart=on-failure
+User=prometheus
+ExecStart=/usr/local/bin/bind_exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [7uu13-2]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpr9b8oy1d/bind_exporter.service.j2
@@ -0,0 +1,10 @@
+[Unit]
+Description=Prometheus exporter for Bind
+
+[Service]
+Restart=on-failure
+User=prometheus
+ExecStart=/usr/local/bin/bind_exporter
+
+[Install]
+WantedBy=multi-user.target

changed: [7uu13-1]

TASK [bind : Ensure bind exporter service is started and enabled] **************
changed: [7uu13-2]
changed: [7uu13-3]
changed: [7uu13-1]

RUNNING HANDLER [bind : Reload systemd] ****************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

RUNNING HANDLER [bind : Restart Bind9 Exporter] ********************************
changed: [7uu13-2]
changed: [7uu13-3]
changed: [7uu13-1]

PLAY [Configure resolv.conf on all machines] ***********************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-3]
ok: [7uu13-1]

TASK [resolver : Gather facts] *************************************************
ok: [7uu13-2]
ok: [7uu13-3]
ok: [7uu13-1]

TASK [resolver : Stop and Disable systemd-resolevd] ****************************
changed: [7uu13-1]
changed: [7uu13-3]
changed: [7uu13-2]

TASK [resolver : Configure resolv.conf] ****************************************
--- before: /etc/resolv.conf
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp2j3234y7/resolv.conf.j2
@@ -1,23 +1,4 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+nameserver 192.168.43.57
+nameserver 192.168.43.100
+search lockbox.sec
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal

changed: [7uu13-2]
--- before: /etc/resolv.conf
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmprgq1fkof/resolv.conf.j2
@@ -1,23 +1,4 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+nameserver 192.168.43.57
+nameserver 192.168.43.100
+search lockbox.sec
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal

changed: [7uu13-1]
--- before: /etc/resolv.conf
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpqjrdoju5/resolv.conf.j2
@@ -1,23 +1,4 @@
-# This is /run/systemd/resolve/stub-resolv.conf managed by man:systemd-resolved(8).
-# Do not edit.
-#
-# This file might be symlinked as /etc/resolv.conf. If you're looking at
-# /etc/resolv.conf and seeing this text, you have followed the symlink.
-#
-# This is a dynamic resolv.conf file for connecting local clients to the
-# internal DNS stub resolver of systemd-resolved. This file lists all
-# configured search domains.
-#
-# Run "resolvectl status" to see details about the uplink DNS servers
-# currently in use.
-#
-# Third party programs should typically not access this file directly, but only
-# through the symlink at /etc/resolv.conf. To manage man:resolv.conf(5) in a
-# different way, replace this symlink by a static file or a different symlink.
-#
-# See man:systemd-resolved.service(8) for details about the supported modes of
-# operation for /etc/resolv.conf.
+nameserver 192.168.43.57
+nameserver 192.168.43.100
+search lockbox.sec
 
-nameserver 127.0.0.53
-options edns0 trust-ad
-search openstacklocal

changed: [7uu13-3]

PLAY [Database Server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Install MySql] ***************************************************
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libbusiness-isbn-perl libwww-perl
  mailx tinyca python-pymysql-doc
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server mysql-server-8.0 mysql-server-core-8.0
  python3-pymysql
0 upgraded, 28 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]
The following additional packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server-8.0 mysql-server-core-8.0
Suggested packages:
  libdata-dump-perl libipc-sharedcache-perl libbusiness-isbn-perl libwww-perl
  mailx tinyca python-pymysql-doc
The following NEW packages will be installed:
  libcgi-fast-perl libcgi-pm-perl libclone-perl libencode-locale-perl
  libevent-pthreads-2.1-7 libfcgi-bin libfcgi-perl libfcgi0ldbl
  libhtml-parser-perl libhtml-tagset-perl libhtml-template-perl
  libhttp-date-perl libhttp-message-perl libio-html-perl
  liblwp-mediatypes-perl libmecab2 libprotobuf-lite23 liburi-perl mecab-ipadic
  mecab-ipadic-utf8 mecab-utils mysql-client-8.0 mysql-client-core-8.0
  mysql-common mysql-server mysql-server-8.0 mysql-server-core-8.0
  python3-pymysql
0 upgraded, 28 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]

TASK [mysql : Override Default Bind-Addr] **************************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp5fnb13su/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 313

changed: [7uu13-1]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpioaqvvza/override.cnf.j2
@@ -0,0 +1,6 @@
+[mysqld]
+bind-address = 0.0.0.0
+log-bin = /var/log/mysql/mysql-bin.log
+relay-log = /var/log/mysql/mysql-relay.log
+replicate-do-db = agama
+server-id = 356

changed: [7uu13-2]

TASK [mysql : Create a new database with name 'agama'] *************************
changed: [7uu13-1]
changed: [7uu13-2]

TASK [mysql : Create a new user with name 'agama'] *****************************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [mysql : Create a new user with name 'replication'] ***********************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [mysql : Install prometheus-mysqld-exporter] ******************************
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]
The following NEW packages will be installed:
  prometheus-mysqld-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]

TASK [mysql : Configure my.cnf for prometheus node exporter] *******************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [mysql : Ensure that Mysql and it's exporter service are started and enabled] ***
ok: [7uu13-2] => (item=mysql)
ok: [7uu13-1] => (item=mysql)

TASK [mysql : Create a new user with name 'exporter'] **************************
changed: [7uu13-1]
changed: [7uu13-2]

TASK [mysql : Create a backup directory] ***************************************
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-2]
--- before
+++ after
@@ -1,5 +1,5 @@
 {
-    "owner": 0,
+    "owner": 34,
     "path": "/home/backup/mysql",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-1]

TASK [mysql : Add user named 'backup' to mysql] ********************************
changed: [7uu13-1]
changed: [7uu13-2]

TASK [mysql : Add my.cnf conf for user backup] *********************************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [mysql : Turn on Read only on the slave node] *****************************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [Add both Mysql CNAME records] ********************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [mysql : Configure Cron for backups] **************************************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [mysql : Ensure that prometheus node exporter is running] *****************
changed: [7uu13-2]
changed: [7uu13-1]

RUNNING HANDLER [mysql : Restart MySql service] ********************************
changed: [7uu13-2]
changed: [7uu13-1]

RUNNING HANDLER [mysql : Restart MySql Node Exporter] **************************
changed: [7uu13-2]
changed: [7uu13-1]

RUNNING HANDLER [mysql : Reset MySQL source] ***********************************
skipping: [7uu13-2] => (item=stopreplica) 
skipping: [7uu13-2] => (item=resetprimary) 
skipping: [7uu13-2]
changed: [7uu13-1] => (item=stopreplica)
changed: [7uu13-1] => (item=resetprimary)

RUNNING HANDLER [mysql : Reset MySQL replica] **********************************
skipping: [7uu13-1] => (item=stopreplica) 
skipping: [7uu13-1] => (item=changeprimary) 
skipping: [7uu13-1] => (item=resetreplica) 
skipping: [7uu13-1] => (item=startreplica) 
skipping: [7uu13-1]
changed: [7uu13-2] => (item=stopreplica)
changed: [7uu13-2] => (item=changeprimary)
changed: [7uu13-2] => (item=resetreplica)
changed: [7uu13-2] => (item=startreplica)

PLAY [Web Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [nginx : Install Nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx nginx-common nginx-core
0 upgraded, 20 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx nginx-common nginx-core
0 upgraded, 20 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]

TASK [nginx : Copy local Nginx configuration file] *****************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpbbumhl0q/default.j2
@@ -1,91 +1,23 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+		location / {
+		proxy_pass http://localhost:8001;
+	}
+	
+	
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+server {
+    listen 8080 default_server;
+    location /stub_status {
+        stub_status;
+    }
 }
 
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+
+
+

changed: [7uu13-2]
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp1lwi3dkn/default.j2
@@ -1,91 +1,23 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+		location / {
+		proxy_pass http://localhost:8001;
+	}
+	
+	
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+server {
+    listen 8080 default_server;
+    location /stub_status {
+        stub_status;
+    }
 }
 
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+
+
+

changed: [7uu13-1]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Flush nginx handlers] ********************************************

RUNNING HANDLER [nginx : Restart Nginx Service] ********************************
changed: [7uu13-1]
changed: [7uu13-2]

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-1] => (item=nginx)
ok: [7uu13-2] => (item=nginx)
ok: [7uu13-1] => (item=prometheus-nginx-exporter)
ok: [7uu13-2] => (item=prometheus-nginx-exporter)

TASK [docker : Install Docker] *************************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz runc ubuntu-fan
0 upgraded, 7 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz runc ubuntu-fan
0 upgraded, 7 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]

TASK [docker : Add ubuntu to docker group] *************************************
changed: [7uu13-1]
changed: [7uu13-2]

TASK [docker : Ensure Docker service is started] *******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [agama : Add folder for Agama and assign it correct permissions] **********
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-1]
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/agama",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-2]

TASK [agama : Install Agama source and it's Dockerfile] ************************
changed: [7uu13-2] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
changed: [7uu13-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
changed: [7uu13-2] => (item=https://raw.githubusercontent.com/hudolejev/agama/refs/heads/master/Dockerfile)
changed: [7uu13-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/refs/heads/master/Dockerfile)

TASK [agama : Build Agama Container] *******************************************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [agama : Create Agama Container] ******************************************
changed: [7uu13-2] => (item=None)
changed: [7uu13-1] => (item=None)
changed: [7uu13-2] => (item=None)
changed: [7uu13-2]
changed: [7uu13-1] => (item=None)
changed: [7uu13-1]

TASK [Add both Agama CNAME records] ********************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [haproxy : Install HaProxy] ***********************************************
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]
The following additional packages will be installed:
  liblua5.3-0
Suggested packages:
  vim-haproxy haproxy-doc
The following NEW packages will be installed:
  haproxy liblua5.3-0
0 upgraded, 2 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]

TASK [haproxy : Configure HaProxy] *********************************************
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp985s8d5j/haproxy.cfg.j2
@@ -8,14 +8,11 @@
 	group haproxy
 	daemon
 
-	# Default SSL material locations
 	ca-base /etc/ssl/certs
 	crt-base /etc/ssl/private
 
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
+	ssl-default-bind-ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS
+	ssl-default-bind-options no-sslv3
 
 defaults
 	log	global
@@ -32,3 +29,21 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen stats
+    mode http
+    bind *:9188
+    stats enable
+    stats uri /haproxy?stats
+    stats refresh 5s
+
+frontend my_ha_frontend
+    bind :88
+    default_backend my_ha_backend
+
+backend my_ha_backend
+      server www-1-agama-1 www-1:8001 check
+      server www-1-agama-2 www-1:8002 check
+        server www-2-agama-1 www-2:8001 check
+      server www-2-agama-2 www-2:8002 check
+  

changed: [7uu13-2]
--- before: /etc/haproxy/haproxy.cfg
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpfs0l9bw3/haproxy.cfg.j2
@@ -8,14 +8,11 @@
 	group haproxy
 	daemon
 
-	# Default SSL material locations
 	ca-base /etc/ssl/certs
 	crt-base /etc/ssl/private
 
-	# See: https://ssl-config.mozilla.org/#server=haproxy&server-version=2.0.3&config=intermediate
-        ssl-default-bind-ciphers ECDHE-ECDSA-AES128-GCM-SHA256:ECDHE-RSA-AES128-GCM-SHA256:ECDHE-ECDSA-AES256-GCM-SHA384:ECDHE-RSA-AES256-GCM-SHA384:ECDHE-ECDSA-CHACHA20-POLY1305:ECDHE-RSA-CHACHA20-POLY1305:DHE-RSA-AES128-GCM-SHA256:DHE-RSA-AES256-GCM-SHA384
-        ssl-default-bind-ciphersuites TLS_AES_128_GCM_SHA256:TLS_AES_256_GCM_SHA384:TLS_CHACHA20_POLY1305_SHA256
-        ssl-default-bind-options ssl-min-ver TLSv1.2 no-tls-tickets
+	ssl-default-bind-ciphers ECDH+AESGCM:DH+AESGCM:ECDH+AES256:DH+AES256:ECDH+AES128:DH+AES:RSA+AESGCM:RSA+AES:!aNULL:!MD5:!DSS
+	ssl-default-bind-options no-sslv3
 
 defaults
 	log	global
@@ -32,3 +29,21 @@
 	errorfile 502 /etc/haproxy/errors/502.http
 	errorfile 503 /etc/haproxy/errors/503.http
 	errorfile 504 /etc/haproxy/errors/504.http
+
+listen stats
+    mode http
+    bind *:9188
+    stats enable
+    stats uri /haproxy?stats
+    stats refresh 5s
+
+frontend my_ha_frontend
+    bind :88
+    default_backend my_ha_backend
+
+backend my_ha_backend
+      server www-1-agama-1 www-1:8001 check
+      server www-1-agama-2 www-1:8002 check
+        server www-2-agama-1 www-2:8001 check
+      server www-2-agama-2 www-2:8002 check
+  

changed: [7uu13-1]

TASK [haproxy : Install haproxy node exporter] *********************************
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]
The following NEW packages will be installed:
  prometheus-haproxy-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]

TASK [haproxy : Configure haproxy node exporter] *******************************
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp_06u3b8h/haproxy-exporter.args.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri="http://localhost:9188/stats;csv"

changed: [7uu13-2]
--- before: /etc/default/prometheus-haproxy-exporter
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp5u33ihww/haproxy-exporter.args.j2
@@ -1,35 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell scaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# Prometheus-haproxy-exporter supports the following options:
-#
-#  --web.listen-address=":9101"
-#    Address to listen on for web interface and telemetry.
-#  --web.telemetry-path="/metrics"
-#    Path under which to expose metrics.
-#  --haproxy.scrape-uri="http://localhost/;csv"
-#    URI on which to scrape HAProxy.
-#  --haproxy.ssl-verify
-#    Flag that enables SSL certificate verification for the scrape URI
-#  --haproxy.server-metric-fields="2,3,4,5,6,7,8,9,13,14,15,16,17,18,21,24,33,35,38,39,40,41,42,43,44"
-#    Comma-separated list of exported server metrics. See
-#    http://cbonte.github.io/haproxy-dconv/configuration-1.5.html#9.1
-#  --haproxy.timeout=5s
-#    Timeout for trying to get stats from HAProxy.
-#  --haproxy.pid-file=""
-#    Path to HAProxy pid file.
-#
-#    If provided, the standard process metrics get exported for the HAProxy
-#    process, prefixed with 'haproxy_process_...'. The haproxy_process exporter
-#    needs to have read access to files owned by the HAProxy process. Depends
-#    on the availability of /proc.
-#    https://prometheus.io/docs/instrumenting/writing_clientlibs/#process-metrics.
-#  --log.level="info"
-#    Only log messages with the given severity or above.
-#    Valid levels: [debug, info, warn, error, fatal]
-#  --log.format="logger:stderr"
-#    Set the log target and format. Example:
-#    "logger:syslog?appname=bob&local=7" or "logger:stdout?json=true"
+ARGS="--haproxy.scrape-uri="http://localhost:9188/stats;csv"

changed: [7uu13-1]

TASK [haproxy : Ensure that haproxy and its exporter are running and enabled] ***
ok: [7uu13-2] => (item=haproxy)
ok: [7uu13-1] => (item=haproxy)
ok: [7uu13-2] => (item=prometheus-haproxy-exporter)
ok: [7uu13-1] => (item=prometheus-haproxy-exporter)

TASK [Add both Haproxy CNAME records] ******************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-2]
changed: [7uu13-1]

TASK [keepalived : Install Keepalived] *****************************************
The following additional packages will be installed:
  ipvsadm libsensors-config libsensors5 libsnmp-base libsnmp40
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libsensors-config libsensors5 libsnmp-base libsnmp40
0 upgraded, 6 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-1]
The following additional packages will be installed:
  ipvsadm libsensors-config libsensors5 libsnmp-base libsnmp40
Suggested packages:
  heartbeat ldirectord lm-sensors snmp-mibs-downloader
The following NEW packages will be installed:
  ipvsadm keepalived libsensors-config libsensors5 libsnmp-base libsnmp40
0 upgraded, 6 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-2]

TASK [keepalived : Configure Keepalived] ***************************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmptdaxljj9/keepalived.conf.j2
@@ -0,0 +1,28 @@
+vrrp_script check_haproxy {
+    script "/usr/bin/killall -0 haproxy"
+    weight 20
+    interval 1
+}
+vrrp_instance VI_1 {
+        state BACKUP
+    priority 90
+        interface ens3
+    virtual_router_id 51
+    advert_int 1
+
+    authentication {
+        auth_type PASS
+        auth_pass PaSsw@rD
+    }
+
+    virtual_ipaddress {
+        192.168.101.57/24
+    }
+    unicast_peer {
+        192.168.43.57
+        192.168.43.100
+    }
+    track_script {
+        check_haproxy
+    }
+}

changed: [7uu13-2]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpq1ocltz1/keepalived.conf.j2
@@ -0,0 +1,28 @@
+vrrp_script check_haproxy {
+    script "/usr/bin/killall -0 haproxy"
+    weight 20
+    interval 1
+}
+vrrp_instance VI_1 {
+        state MASTER
+    priority 100
+        interface ens3
+    virtual_router_id 51
+    advert_int 1
+
+    authentication {
+        auth_type PASS
+        auth_pass PaSsw@rD
+    }
+
+    virtual_ipaddress {
+        192.168.101.57/24
+    }
+    unicast_peer {
+        192.168.43.57
+        192.168.43.100
+    }
+    track_script {
+        check_haproxy
+    }
+}

changed: [7uu13-1]

TASK [keepalived : Install keepalived node exporter] ***************************
changed: [7uu13-1]
changed: [7uu13-2]

TASK [keepalived : Install the downloaded keepalived exporter .deb file] *******
Selecting previously unselected package keepalived-exporter.
(Reading database ... 59338 files and directories currently installed.)
Preparing to unpack /var/tmp/package.deb ...
Unpacking keepalived-exporter (1.4.0) ...
Setting up keepalived-exporter (1.4.0) ...
changed: [7uu13-1]
Selecting previously unselected package keepalived-exporter.
(Reading database ... 59338 files and directories currently installed.)
Preparing to unpack /var/tmp/package.deb ...
Unpacking keepalived-exporter (1.4.0) ...
Setting up keepalived-exporter (1.4.0) ...
changed: [7uu13-2]

TASK [keepalived : Create service file for keepalived exporter] ****************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpnyxu42_7/keepalived-exporter.service.j2
@@ -0,0 +1,9 @@
+[Unit]
+
+[Service]
+Restart=always
+User=root
+ExecStart=/usr/bin/keepalived-exporter $ARGS
+
+[Install]
+WantedBy=multi-user.target

changed: [7uu13-2]
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp7jqx60n4/keepalived-exporter.service.j2
@@ -0,0 +1,9 @@
+[Unit]
+
+[Service]
+Restart=always
+User=root
+ExecStart=/usr/bin/keepalived-exporter $ARGS
+
+[Install]
+WantedBy=multi-user.target

changed: [7uu13-1]

TASK [keepalived : Ensure that Keepalived and its exporter are enabled and running] ***
changed: [7uu13-2] => (item=keepalived)
changed: [7uu13-1] => (item=keepalived)
changed: [7uu13-2] => (item=keepalived-exporter)
changed: [7uu13-1] => (item=keepalived-exporter)

RUNNING HANDLER [haproxy : Restart haproxy] ************************************
changed: [7uu13-2]
changed: [7uu13-1]

RUNNING HANDLER [haproxy : Restart haproxy exporter] ***************************
changed: [7uu13-2]
changed: [7uu13-1]

RUNNING HANDLER [keepalived : Restart keepalived] ******************************
changed: [7uu13-1]
changed: [7uu13-2]

RUNNING HANDLER [keepalived : Reload systemd] **********************************
ok: [7uu13-1]
ok: [7uu13-2]

RUNNING HANDLER [keepalived : Restart keepalived-exporter] *********************
changed: [7uu13-1]
changed: [7uu13-2]

PLAY [Install and configure prometheus] ****************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [nginx : Install Nginx] ***************************************************
The following additional packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx-common nginx-core
Suggested packages:
  libgd-tools fcgiwrap nginx-doc ssl-cert
The following NEW packages will be installed:
  fontconfig-config fonts-dejavu-core libdeflate0 libfontconfig1 libgd3
  libjbig0 libjpeg-turbo8 libjpeg8 libnginx-mod-http-geoip2
  libnginx-mod-http-image-filter libnginx-mod-http-xslt-filter
  libnginx-mod-mail libnginx-mod-stream libnginx-mod-stream-geoip2 libtiff5
  libwebp7 libxpm4 nginx nginx-common nginx-core
0 upgraded, 20 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-3]

TASK [nginx : Copy local Nginx configuration file] *****************************
--- before: /etc/nginx/sites-enabled/default
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpv7ux3nul/default.j2
@@ -1,91 +1,27 @@
-##
-# You should look at the following URL's in order to grasp a solid understanding
-# of Nginx configuration files in order to fully unleash the power of Nginx.
-# https://www.nginx.com/resources/wiki/start/
-# https://www.nginx.com/resources/wiki/start/topics/tutorials/config_pitfalls/
-# https://wiki.debian.org/Nginx/DirectoryStructure
-#
-# In most cases, administrators will remove this file from sites-enabled/ and
-# leave it as reference inside of sites-available where it will continue to be
-# updated by the nginx packaging team.
-#
-# This file will automatically load configuration files provided by other
-# applications, such as Drupal or Wordpress. These applications will be made
-# available underneath a path with that package name, such as /drupal8.
-#
-# Please see /usr/share/doc/nginx-doc/examples/ for more detailed examples.
-##
-
-# Default server configuration
-#
 server {
 	listen 80 default_server;
-	listen [::]:80 default_server;
-
-	# SSL configuration
-	#
-	# listen 443 ssl default_server;
-	# listen [::]:443 ssl default_server;
-	#
-	# Note: You should disable gzip for SSL traffic.
-	# See: https://bugs.debian.org/773332
-	#
-	# Read up on ssl_ciphers to ensure a secure configuration.
-	# See: https://bugs.debian.org/765782
-	#
-	# Self signed certs generated by the ssl-cert package
-	# Don't use them in a production server!
-	#
-	# include snippets/snakeoil.conf;
-
-	root /var/www/html;
-
-	# Add index.php to the list if you are using PHP
-	index index.html index.htm index.nginx-debian.html;
-
 	server_name _;
 
-	location / {
-		# First attempt to serve request as file, then
-		# as directory, then fall back to displaying a 404.
-		try_files $uri $uri/ =404;
+	
+	    location /prometheus {
+        proxy_pass http://localhost:9090;
+    }
+	
+	    location /grafana {
+		proxy_set_header Host $http_host;
+        proxy_pass http://localhost:3001;
+    }
 	}
 
-	# pass PHP scripts to FastCGI server
-	#
-	#location ~ \.php$ {
-	#	include snippets/fastcgi-php.conf;
-	#
-	#	# With php-fpm (or other unix sockets):
-	#	fastcgi_pass unix:/run/php/php7.4-fpm.sock;
-	#	# With php-cgi (or other tcp sockets):
-	#	fastcgi_pass 127.0.0.1:9000;
-	#}
-
-	# deny access to .htaccess files, if Apache's document root
-	# concurs with nginx's one
-	#
-	#location ~ /\.ht {
-	#	deny all;
-	#}
+server {
+    listen 8080 default_server;
+    location /stub_status {
+        stub_status;
+    }
 }
 
 
-# Virtual Host configuration for example.com
-#
-# You can move that to a different file under sites-available/ and symlink that
-# to sites-enabled/ to enable it.
-#
-#server {
-#	listen 80;
-#	listen [::]:80;
-#
-#	server_name example.com;
-#
-#	root /var/www/example.com;
-#	index index.html;
-#
-#	location / {
-#		try_files $uri $uri/ =404;
-#	}
-#}
+
+
+
+

changed: [7uu13-3]

TASK [nginx : Flush nginx handlers] ********************************************

RUNNING HANDLER [nginx : Restart Nginx Service] ********************************
changed: [7uu13-3]

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
The following NEW packages will be installed:
  prometheus-nginx-exporter
0 upgraded, 1 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-3]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-3] => (item=nginx)
ok: [7uu13-3] => (item=prometheus-nginx-exporter)

TASK [prometheus : Install Prometheus] *****************************************
The following additional packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
The following NEW packages will be installed:
  fonts-glyphicons-halflings javascript-common libjs-bootstrap
  libjs-bootstrap4 libjs-d3 libjs-eonasdan-bootstrap-datetimepicker
  libjs-jquery libjs-jquery-hotkeys libjs-moment libjs-moment-timezone
  libjs-mustache libjs-popper.js libjs-rickshaw libjs-sizzle node-jquery
  prometheus
0 upgraded, 16 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-3]

TASK [prometheus : Configure Prometheus] ***************************************
--- before: /etc/prometheus/prometheus.yml
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpr8hsxp7p/prometheus.yml.j2
@@ -1,44 +1,66 @@
-# Sample config for Prometheus.
+global:
+  scrape_interval:     15s
+  evaluation_interval: 15s
 
-global:
-  scrape_interval:     15s # Set the scrape interval to every 15 seconds. Default is every 1 minute.
-  evaluation_interval: 15s # Evaluate rules every 15 seconds. The default is every 1 minute.
-  # scrape_timeout is set to the global default (10s).
-
-  # Attach these labels to any time series or alerts when communicating with
-  # external systems (federation, remote storage, Alertmanager).
   external_labels:
       monitor: 'example'
 
-# Alertmanager configuration
 alerting:
   alertmanagers:
   - static_configs:
     - targets: ['localhost:9093']
 
-# Load rules once and periodically evaluate them according to the global 'evaluation_interval'.
-rule_files:
-  # - "first_rules.yml"
-  # - "second_rules.yml"
-
-# A scrape configuration containing exactly one endpoint to scrape:
-# Here it's Prometheus itself.
 scrape_configs:
-  # The job name is added as a label `job=<job_name>` to any timeseries scraped from this config.
   - job_name: 'prometheus'
-
-    # Override the global default and scrape targets from this job every 5 seconds.
-    scrape_interval: 5s
-    scrape_timeout: 5s
-
-    # metrics_path defaults to '/metrics'
-    # scheme defaults to 'http'.
-
     static_configs:
       - targets: ['localhost:9090']
+    metrics_path: /prometheus/metrics
 
-  - job_name: node
-    # If prometheus-node-exporter is installed, grab stats about the local
-    # machine by default.
+  - job_name: 'linux'
     static_configs:
-      - targets: ['localhost:9100']
+      - targets:
+              - '7uu13-1:9100'
+              - '7uu13-2:9100'
+              - '7uu13-3:9100'
+      
+  - job_name: 'mysql'
+    static_configs:
+      - targets:
+              - 'mysql-1:9104'
+              - 'mysql-2:9104'
+      
+  - job_name: 'nginx'
+    static_configs:
+      - targets:
+              - 'www-1:9113'
+              - 'www-2:9113'
+              - 'prometheus:9113'
+            
+  - job_name: 'bind'
+    static_configs:
+      - targets:
+              - 'ns-1:9119'
+              - 'ns-2:9119'
+              - 'ns-3:9119'
+          
+  - job_name: 'influxdb'
+    static_configs:
+      - targets:
+        - 'influxdb:9424'
+
+  - job_name: 'haproxy'
+    static_configs:
+      - targets:
+              - 'lb-1:9101'
+              - 'lb-2:9101'
+      
+  - job_name: 'keepalived'
+    static_configs:
+      - targets:
+              - 'lb-1:9165'
+              - 'lb-2:9165'
+      
+  - job_name: 'backup'
+    static_configs:
+      - targets:
+        - 'backup:9111'
\ No newline at end of file

changed: [7uu13-3]

TASK [prometheus : Ensure Prometheus service is started and enabled] ***********
ok: [7uu13-3]

TASK [prometheus : Configure /etc/default for prometheus] **********************
--- before: /etc/default/prometheus
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpi7qtwq9x/prometheus.j2
@@ -1,110 +1 @@
-# Set the command-line arguments to pass to the server.
-# Due to shell escaping, to pass backslashes for regexes, you need to double
-# them (\\d for \d). If running under systemd, you need to double them again
-# (\\\\d to mean \d), and escape newlines too.
-ARGS=""
-
-# prometheus supports the following options:
-#
-#  --alertmanager.notification-queue-capacity=10000
-#    The capacity of the queue for pending Alertmanager notifications.
-#  --config.file="/etc/prometheus/prometheus.yml"
-#    Prometheus configuration file path.
-#  --enable-feature=<feature,...>
-#    Comma separated feature names to enable. Valid options:
-#    exemplar-storage, expand-external-labels, memory-snapshot-on-shutdown,
-#    promql-at-modifier, promql-negative-offset, remote-write-receiver,
-#    extra-scrape-metrics, new-service-discovery-manager. See
-#    https://prometheus.io/docs/prometheus/latest/feature_flags/ for more
-#    details.
-#  --log.format=logfmt
-#    Output format of log messages. One of: [logfmt, json].
-#  --log.level=info
-#    Only log messages with the given severity or above. One of: [debug, info,
-#    warn, error].
-#  --query.lookback-delta=5m
-#    The maximum lookback duration for retrieving metrics during expression
-#    evaluations and federation.
-#  --query.max-concurrency=20
-#    Maximum number of queries executed concurrently.
-#  --query.max-samples=50000000
-#    Maximum number of samples a single query can load into memory. Note that
-#    queries will fail if they try to load more samples than this into memory,
-#    so this also limits the number of samples a query can return.
-#  --query.timeout=2m
-#    Maximum time a query may take before being aborted.
-#  --rules.alert.for-grace-period=10m
-#    Minimum duration between alert and restored "for" state. This is
-#    maintained only for alerts with configured "for" time greater than grace
-#    period.
-#  --rules.alert.for-outage-tolerance=1h
-#    Max time to tolerate prometheus outage for restoring "for" state of alert.
-#  --rules.alert.resend-delay=1m
-#    Minimum amount of time to wait before resending an alert to Alertmanager.
-#  --storage.remote.flush-deadline=<duration>
-#    How long to wait flushing sample on shutdown or config reload.
-#  --storage.remote.read-concurrent-limit=10
-#    Maximum number of concurrent remote read calls. 0 means no limit.
-#  --storage.remote.read-max-bytes-in-frame=1048576
-#    Maximum number of bytes in a single frame for streaming remote read
-#    response types before marshalling. Note that client might have limit on
-#    frame size as well. 1MB as recommended by protobuf by default.
-#  --storage.remote.read-sample-limit=5e7
-#    Maximum overall number of samples to return via the remote read interface,
-#    in a single query. 0 means no limit. This limit is ignored for streamed
-#    response types.
-#  --storage.tsdb.allow-overlapping-blocks
-#    Allow overlapping blocks, which in turn enables vertical compaction and
-#    vertical query merge.
-#  --storage.tsdb.path="/var/lib/prometheus/metrics2/"
-#    Base path for metrics storage.
-#  --storage.tsdb.retention.size=STORAGE.TSDB.RETENTION.SIZE
-#    Maximum number of bytes that can be stored for blocks. A unit is required,
-#    supported units: B, KB, MB, GB, TB, PB, EB. Ex: "512MB".
-#  --storage.tsdb.retention.time=STORAGE.TSDB.RETENTION.TIME
-#    How long to retain samples in storage. When this flag is set it overrides
-#    "storage.tsdb.retention". If neither this flag nor
-#    "storage.tsdb.retention" nor "storage.tsdb.retention.size" is set, the
-#    retention time defaults to 15d. Units Supported: y, w, d, h, m, s, ms.
-#  --storage.tsdb.retention=STORAGE.TSDB.RETENTION
-#    [DEPRECATED] How long to retain samples in storage. This flag has been
-#    deprecated, use "storage.tsdb.retention.time" instead.
-#  --storage.tsdb.use-lockfile
-#    Create a lockfile in data directory.
-#  --web.config.file=""
-#    [EXPERIMENTAL] Path to configuration file that can enable TLS or
-#    authentication.
-#  --web.console.libraries="/etc/prometheus/console_libraries"
-#    Path to the console library directory.
-#  --web.console.templates="/etc/prometheus/consoles"
-#    Path to the console template directory, available at /consoles.
-#  --web.cors.origin=".*"
-#    Regex for CORS origin. It is fully anchored. Example:
-#    'https?://(domain1|domain2)\.com'.
-#  --web.enable-admin-api
-#    Enable API endpoints for admin control actions.
-#  --web.enable-lifecycle
-#    Enable shutdown and reload via HTTP request.
-#  --web.external-url=<URL>
-#    The URL under which Prometheus is externally reachable (for example, if
-#    Prometheus is served via a reverse proxy). Used for generating relative
-#    and absolute links back to Prometheus itself. If the URL has a path
-#    portion, it will be used to prefix all HTTP endpoints served by
-#    Prometheus. If omitted, relevant URL components will be derived
-#    automatically.
-#  --web.listen-address="0.0.0.0:9090"
-#    Address to listen on for UI, API, and telemetry.
-#  --web.local-assets="/usr/share/prometheus/web/"
-#    Path to static asset/templates directory.
-#  --web.max-connections=512
-#    Maximum number of simultaneous connections.
-#  --web.page-title="Prometheus Time Series Collection and Processing Server"
-#    Document title of Prometheus instance.
-#  --web.read-timeout=5m
-#    Maximum duration before timing out read of the request, and closing idle
-#    connections.
-#  --web.route-prefix=<path>
-#    Prefix for the internal routes of web endpoints. Defaults to path of
-#    --web.external-url.
-#  --web.user-assets=<path>
-#    Path to user asset directory, available at /user.
+ARGS="--web.external-url=http://prometheus/prometheus"

changed: [7uu13-3]

TASK [Add Prometheus CNAME record] *********************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-3]

RUNNING HANDLER [prometheus : Restart Prometheus] ******************************
changed: [7uu13-3]

PLAY [Install and configure Grafana] *******************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [docker : Install Docker] *************************************************
The following additional packages will be installed:
  bridge-utils containerd dnsmasq-base pigz runc ubuntu-fan
Suggested packages:
  ifupdown aufs-tools cgroupfs-mount | cgroup-lite debootstrap docker-doc
  rinse zfs-fuse | zfsutils
The following NEW packages will be installed:
  bridge-utils containerd dnsmasq-base docker.io pigz runc ubuntu-fan
0 upgraded, 7 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-3]

TASK [docker : Add ubuntu to docker group] *************************************
changed: [7uu13-3]

TASK [docker : Ensure Docker service is started] *******************************
ok: [7uu13-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-3]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-3]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-3]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-3] => (item=nginx)
ok: [7uu13-3] => (item=prometheus-nginx-exporter)

TASK [grafana : Create Grafana directory] **************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/dashboards",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-3] => (item=dashboards)
--- before
+++ after
@@ -1,4 +1,4 @@
 {
     "path": "/opt/grafana/provisioning/datasources",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-3] => (item=datasources)

TASK [grafana : Add grafana.ini] ***********************************************
changed: [7uu13-3]

TASK [grafana : Add default dashboard and datasources] *************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpzvay8dmt/datasources.yaml.j2
@@ -0,0 +1,24 @@
+apiVersion: 1
+
+datasources:
+  - name: Prometheus
+    type: prometheus
+    url: http://prometheus:9090/prometheus
+    access: proxy
+    isDefault: false
+
+  - name: "InfluxDB:agama_client"
+    type: influxdb
+    url: http://influxdb:8086
+    access: proxy
+    editable: true
+    database: agama_stats
+    isDefault: false
+
+  - name: "InfluxDB:Telegraf"
+    type: influxdb
+    url: http://influxdb:8086
+    access: proxy
+    editable: true
+    database: telegraf
+    isDefault: false
\ No newline at end of file

changed: [7uu13-3] => (item=datasources)
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpt9dvn320/dashboards.yaml.j2
@@ -0,0 +1,13 @@
+apiVersion: 1
+
+providers:
+  - name: 'Main'
+    orgId: 1
+    folder: ''
+    type: file
+    disableDeletion: false
+    updateIntervalSeconds: 10
+    allowUiUpdates: false
+    options:
+      path: /etc/grafana/provisioning/dashboards
+      foldersFromFilesStructure: true
\ No newline at end of file

changed: [7uu13-3] => (item=dashboards)

TASK [grafana : Add dashboards] ************************************************
--- before
+++ after: /home/johan/school/ica0002/roles/grafana/files/main.json
@@ -0,0 +1,1161 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 4,
+  "links": [],
+  "panels": [
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "id": 1,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "100 - (avg by (instance) (irate(node_cpu_seconds_total{mode=\"idle\"}[5m])) * 100)",
+          "legendFormat": "{{instance}}",
+          "refId": "A"
+        }
+      ],
+      "title": "CPU Utilization",
+      "type": "timeseries"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "id": 2,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "100 * (1 - (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes))",
+          "legendFormat": "{{instance}}",
+          "refId": "A"
+        }
+      ],
+      "title": "Memory Usage",
+      "type": "timeseries"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "text": "OK"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 8,
+        "x": 0,
+        "y": 8
+      },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "up{job=\"bind\"}",
+          "refId": "A"
+        }
+      ],
+      "title": "Bind9 Status",
+      "type": "stat"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "text": "OK"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 8,
+        "x": 8,
+        "y": 8
+      },
+      "id": 5,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "up{job=\"mysql\"}",
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Status",
+      "type": "stat"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "text": "OK"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 8,
+        "x": 16,
+        "y": 8
+      },
+      "id": 7,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "up{job=\"nginx\"}",
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx Status",
+      "type": "stat"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 8,
+        "x": 0,
+        "y": 12
+      },
+      "id": 4,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "rate(bind_resolver_queries_total{type=\"A\"}[1m]) * 60",
+          "legendFormat": "A queries/min",
+          "refId": "A"
+        }
+      ],
+      "title": "DNS A Queries/min",
+      "type": "timeseries"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 8,
+        "x": 8,
+        "y": 12
+      },
+      "id": 6,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "rate(mysql_global_status_commands_total{command=\"select\"}[1m]) * 60",
+          "format": "time_series",
+          "legendFormat": "Selects/min",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySQL Selects/min",
+      "type": "timeseries"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 8,
+        "x": 16,
+        "y": 12
+      },
+      "id": 8,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "rate(nginx_http_requests_total[1m]) * 60",
+          "legendFormat": "Requests/min",
+          "refId": "A"
+        }
+      ],
+      "title": "Nginx Requests/min",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P6E19045AB49F7114"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 20
+      },
+      "id": 9,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P6E19045AB49F7114"
+          },
+          "groupBy": [],
+          "measurement": "agama-stats",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "items"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": []
+        }
+      ],
+      "title": "All Agama Instances Items Count",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "P6E19045AB49F7114"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "yellow",
+                "value": 10
+              },
+              {
+                "color": "red",
+                "value": 20
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 20
+      },
+      "id": 10,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "P6E19045AB49F7114"
+          },
+          "groupBy": [],
+          "measurement": "agama-stats",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "query": "SELECT LAST(\"items\") AS \"latest_items\" \nFROM \"agama-stats\" \nWHERE \"name\" =~ /^7uu13/\nGROUP BY \"name\"",
+          "rawQuery": true,
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "items"
+                ],
+                "type": "field"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "name::tag",
+              "operator": "=",
+              "value": "7uu13-1.lockbox.sec."
+            }
+          ]
+        }
+      ],
+      "title": "Your Agama Items Count",
+      "type": "stat"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "mappings": [
+            {
+              "options": {
+                "0": {
+                  "color": "red",
+                  "text": "DOWN"
+                },
+                "1": {
+                  "color": "green",
+                  "text": "OK"
+                }
+              },
+              "type": "value"
+            }
+          ],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "red",
+                "value": null
+              },
+              {
+                "color": "green",
+                "value": 1
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 12,
+        "x": 0,
+        "y": 28
+      },
+      "id": 11,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "influxdb_exporter_stats_query_success",
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB Health",
+      "type": "stat"
+    },
+    {
+      "datasource": "Prometheus",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "line",
+            "fillOpacity": 0,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "auto",
+            "spanNulls": false,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 4,
+        "w": 12,
+        "x": 12,
+        "y": 28
+      },
+      "id": 12,
+      "options": {
+        "legend": {
+          "calcs": [],
+          "displayMode": "list",
+          "placement": "bottom",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "single",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "expr": "rate(influxdb_write_write_ok[1m])",
+          "legendFormat": "Writes/min",
+          "refId": "A"
+        }
+      ],
+      "title": "InfluxDB Write Rate",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 32
+      },
+      "id": 13,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "keepalived_up{job=\"keepalived\"}",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "Panel Title",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 32
+      },
+      "id": 14,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "area",
+        "justifyMode": "auto",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "auto",
+        "wideLayout": true
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "disableTextWrap": false,
+          "editorMode": "builder",
+          "expr": "keepalived_vrrp_state{job=\"keepalived\"}",
+          "fullMetaSearch": false,
+          "includeNullMetadata": true,
+          "instant": false,
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A",
+          "useBackend": false
+        }
+      ],
+      "title": "Panel Title",
+      "type": "stat"
+    }
+  ],
+  "preload": false,
+  "refresh": "5s",
+  "schemaVersion": 40,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "",
+  "title": "Main",
+  "uid": "fe3mlgpswu77kd",
+  "version": 1,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [7uu13-3] => (item=main)
--- before
+++ after: /home/johan/school/ica0002/roles/grafana/files/backups.json
@@ -0,0 +1,296 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "grafana",
+          "uid": "-- Grafana --"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 1,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          },
+          "unit": "s"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 0
+      },
+      "id": 4,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "vertical",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "value_and_name",
+        "wideLayout": false
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "time() - backup_last_success_time{user=\"7uu13\", service=\"influxdb\"}",
+          "legendFormat": "{{service}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Time since last successful backup InfluxDB Telegraf",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          },
+          "unit": "s"
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 0
+      },
+      "id": 3,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "horizontal",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "value_and_name",
+        "wideLayout": false
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "expr": "time() - backup_last_success_time{user=\"7uu13\", service=\"mysql\"}",
+          "legendFormat": "{{service}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Time since last successful backup MySql",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "displayName": "Influx full backups",
+          "fieldMinMax": false,
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 0,
+        "y": 8
+      },
+      "id": 1,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "vertical",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "value_and_name",
+        "wideLayout": false
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "prometheus",
+            "uid": "PBFA97CFB590B2093"
+          },
+          "editorMode": "code",
+          "expr": "backups_total{user=\"7uu13\", service=\"influxdb\", type=\"full\"}",
+          "legendFormat": "__auto",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "Influx full backups",
+      "type": "stat"
+    },
+    {
+      "datasource": {
+        "type": "prometheus",
+        "uid": "PBFA97CFB590B2093"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "displayName": "MySql full backups",
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          }
+        },
+        "overrides": []
+      },
+      "gridPos": {
+        "h": 8,
+        "w": 12,
+        "x": 12,
+        "y": 8
+      },
+      "id": 2,
+      "options": {
+        "colorMode": "value",
+        "graphMode": "none",
+        "justifyMode": "center",
+        "orientation": "auto",
+        "percentChangeColorMode": "standard",
+        "reduceOptions": {
+          "calcs": [
+            "lastNotNull"
+          ],
+          "fields": "",
+          "values": false
+        },
+        "showPercentChange": false,
+        "textMode": "value_and_name",
+        "wideLayout": false
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "editorMode": "code",
+          "exemplar": false,
+          "expr": "backups_total{user=\"7uu13\", service=\"mysql\", type=\"full\"}",
+          "interval": "",
+          "legendFormat": "{{service}}",
+          "range": true,
+          "refId": "A"
+        }
+      ],
+      "title": "MySql full backups",
+      "type": "stat"
+    }
+  ],
+  "preload": false,
+  "schemaVersion": 40,
+  "tags": [],
+  "templating": {
+    "list": []
+  },
+  "time": {
+    "from": "now-6h",
+    "to": "now"
+  },
+  "timepicker": {},
+  "timezone": "browser",
+  "title": "Backups",
+  "uid": "be35ojuxmd43kc",
+  "version": 1,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [7uu13-3] => (item=backups)
--- before
+++ after: /home/johan/school/ica0002/roles/grafana/files/mysql.json
@@ -0,0 +1,526 @@
+{
+    "annotations": {
+      "list": [
+        {
+          "builtIn": 1,
+          "datasource": {
+            "type": "grafana",
+            "uid": "-- Grafana --"
+          },
+          "enable": true,
+          "hide": true,
+          "iconColor": "rgba(0, 211, 255, 1)",
+          "name": "Annotations & Alerts",
+          "type": "dashboard"
+        }
+      ]
+    },
+    "editable": true,
+    "fiscalYearStartMonth": 0,
+    "graphTooltip": 0,
+    "id": 3,
+    "links": [],
+    "panels": [
+      {
+        "datasource": {
+          "default": true,
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "text": "DOWN"
+                  },
+                  "1": {
+                    "text": "UP"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "red",
+                  "value": null
+                },
+                {
+                  "color": "green",
+                  "value": 1
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 22,
+          "x": 0,
+          "y": 0
+        },
+        "id": 2,
+        "options": {
+          "colorMode": "background",
+          "graphMode": "none",
+          "justifyMode": "center",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "auto",
+          "wideLayout": true
+        },
+        "pluginVersion": "11.3.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "editorMode": "code",
+            "expr": "mysql_up",
+            "interval": "",
+            "legendFormat": "{{instance}}",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL Status",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 11,
+          "x": 0,
+          "y": 3
+        },
+        "id": 3,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "center",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "value_and_name",
+          "wideLayout": false
+        },
+        "pluginVersion": "11.3.1",
+        "targets": [
+          {
+            "editorMode": "code",
+            "expr": "mysql_global_variables_server_id",
+            "legendFormat": "{{instance}}",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "mysql_global_variables_server_id",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "orange",
+                    "index": 0,
+                    "text": "writeble"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 1,
+                    "text": "read only"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 11,
+          "x": 11,
+          "y": 3
+        },
+        "id": 4,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "center",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "value_and_name",
+          "wideLayout": false
+        },
+        "pluginVersion": "11.3.1",
+        "targets": [
+          {
+            "editorMode": "code",
+            "expr": "mysql_global_variables_read_only",
+            "legendFormat": "{{instance}}",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "mysql_global_variables_read_only",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "thresholds"
+            },
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "Stopped"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "Running"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 11,
+          "x": 0,
+          "y": 6
+        },
+        "id": 5,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "center",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "value_and_name",
+          "wideLayout": false
+        },
+        "pluginVersion": "11.3.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "b111c13e-f3f2-448a-87c1-01bfc6574d9c"
+            },
+            "disableTextWrap": false,
+            "editorMode": "code",
+            "expr": "mysql_slave_status_slave_io_running",
+            "fullMetaSearch": false,
+            "includeNullMetadata": true,
+            "instant": false,
+            "legendFormat": "master: {{master_host}} / replica: {{instance}}",
+            "range": true,
+            "refId": "A",
+            "useBackend": false
+          }
+        ],
+        "title": "Replica I/O thread",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "mappings": [
+              {
+                "options": {
+                  "0": {
+                    "color": "red",
+                    "index": 1,
+                    "text": "Stopped"
+                  },
+                  "1": {
+                    "color": "green",
+                    "index": 0,
+                    "text": "Running"
+                  }
+                },
+                "type": "value"
+              }
+            ],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            }
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 3,
+          "w": 11,
+          "x": 11,
+          "y": 6
+        },
+        "id": 6,
+        "options": {
+          "colorMode": "value",
+          "graphMode": "none",
+          "justifyMode": "center",
+          "orientation": "auto",
+          "percentChangeColorMode": "standard",
+          "reduceOptions": {
+            "calcs": [
+              "lastNotNull"
+            ],
+            "fields": "",
+            "values": false
+          },
+          "showPercentChange": false,
+          "textMode": "value_and_name",
+          "wideLayout": false
+        },
+        "pluginVersion": "11.3.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "b111c13e-f3f2-448a-87c1-01bfc6574d9c"
+            },
+            "disableTextWrap": false,
+            "editorMode": "code",
+            "exemplar": false,
+            "expr": "mysql_slave_status_slave_sql_running",
+            "fullMetaSearch": false,
+            "includeNullMetadata": true,
+            "instant": false,
+            "legendFormat": "master: {{master_host}} / replica: {{instance}}",
+            "range": true,
+            "refId": "A",
+            "useBackend": false
+          }
+        ],
+        "title": "Replica SQL thread",
+        "type": "stat"
+      },
+      {
+        "datasource": {
+          "default": true,
+          "type": "prometheus",
+          "uid": "PBFA97CFB590B2093"
+        },
+        "fieldConfig": {
+          "defaults": {
+            "color": {
+              "mode": "palette-classic"
+            },
+            "custom": {
+              "axisBorderShow": false,
+              "axisCenteredZero": false,
+              "axisColorMode": "text",
+              "axisLabel": "",
+              "axisPlacement": "auto",
+              "barAlignment": 0,
+              "barWidthFactor": 1,
+              "drawStyle": "line",
+              "fillOpacity": 10,
+              "gradientMode": "none",
+              "hideFrom": {
+                "legend": false,
+                "tooltip": false,
+                "viz": false
+              },
+              "insertNulls": false,
+              "lineInterpolation": "linear",
+              "lineStyle": {
+                "fill": "solid"
+              },
+              "lineWidth": 2,
+              "pointSize": 5,
+              "scaleDistribution": {
+                "type": "linear"
+              },
+              "showPoints": "auto",
+              "spanNulls": false,
+              "stacking": {
+                "group": "A",
+                "mode": "none"
+              },
+              "thresholdsStyle": {
+                "mode": "off"
+              }
+            },
+            "mappings": [],
+            "thresholds": {
+              "mode": "absolute",
+              "steps": [
+                {
+                  "color": "green",
+                  "value": null
+                }
+              ]
+            },
+            "unit": "reqpm"
+          },
+          "overrides": []
+        },
+        "gridPos": {
+          "h": 7,
+          "w": 22,
+          "x": 0,
+          "y": 9
+        },
+        "id": 7,
+        "options": {
+          "legend": {
+            "calcs": [],
+            "displayMode": "list",
+            "placement": "bottom",
+            "showLegend": true
+          },
+          "tooltip": {
+            "mode": "multi",
+            "sort": "none"
+          }
+        },
+        "pluginVersion": "11.3.1",
+        "targets": [
+          {
+            "datasource": {
+              "type": "prometheus",
+              "uid": "PBFA97CFB590B2093"
+            },
+            "editorMode": "code",
+            "exemplar": false,
+            "expr": "increase(mysql_global_status_commands_total{command=\"select\"}[1m])",
+            "format": "time_series",
+            "instant": false,
+            "interval": "1m",
+            "legendFormat": "{{instance}}",
+            "range": true,
+            "refId": "A"
+          }
+        ],
+        "title": "MySQL: SELECT queries per minute",
+        "type": "timeseries"
+      }
+    ],
+    "preload": false,
+    "schemaVersion": 40,
+    "tags": [],
+    "templating": {
+      "list": []
+    },
+    "time": {
+      "from": "now-6h",
+      "to": "now"
+    },
+    "timepicker": {},
+    "timezone": "browser",
+    "title": "MySQL",
+    "uid": "de3qz3awym0w0a",
+    "version": 1,
+    "weekStart": ""
+  }
+  
\ No newline at end of file

changed: [7uu13-3] => (item=mysql)
--- before
+++ after: /home/johan/school/ica0002/roles/grafana/files/syslog.json
@@ -0,0 +1,1118 @@
+{
+  "annotations": {
+    "list": [
+      {
+        "builtIn": 1,
+        "datasource": {
+          "type": "datasource",
+          "uid": "grafana"
+        },
+        "enable": true,
+        "hide": true,
+        "iconColor": "rgba(0, 211, 255, 1)",
+        "name": "Annotations & Alerts",
+        "type": "dashboard"
+      }
+    ]
+  },
+  "description": "Telegraf / InfluxDB / Grafana as syslog receiver",
+  "editable": true,
+  "fiscalYearStartMonth": 0,
+  "graphTooltip": 0,
+  "id": 8,
+  "links": [],
+  "panels": [
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "PDD5124384626356D"
+      },
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "palette-classic"
+          },
+          "custom": {
+            "axisBorderShow": false,
+            "axisCenteredZero": false,
+            "axisColorMode": "text",
+            "axisLabel": "Messages / min",
+            "axisPlacement": "auto",
+            "barAlignment": 0,
+            "barWidthFactor": 0.6,
+            "drawStyle": "bars",
+            "fillOpacity": 100,
+            "gradientMode": "none",
+            "hideFrom": {
+              "legend": false,
+              "tooltip": false,
+              "viz": false
+            },
+            "insertNulls": false,
+            "lineInterpolation": "linear",
+            "lineWidth": 1,
+            "pointSize": 5,
+            "scaleDistribution": {
+              "type": "linear"
+            },
+            "showPoints": "never",
+            "spanNulls": true,
+            "stacking": {
+              "group": "A",
+              "mode": "none"
+            },
+            "thresholdsStyle": {
+              "mode": "off"
+            }
+          },
+          "decimals": 0,
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "green",
+                "value": null
+              },
+              {
+                "color": "red",
+                "value": 80
+              }
+            ]
+          },
+          "unit": "none"
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Info"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "rgb(80, 80, 80)",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Notice"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "rgb(182, 182, 182)",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Warning"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "#E0B400",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Error"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "#FF780A",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Critical"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "#E02F44",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Alert"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "#8F3BB8",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Emergency"
+            },
+            "properties": [
+              {
+                "id": "color",
+                "value": {
+                  "fixedColor": "#8F3BB8",
+                  "mode": "fixed"
+                }
+              },
+              {
+                "id": "custom.stacking",
+                "value": {
+                  "group": "A",
+                  "mode": "normal"
+                }
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 7,
+        "w": 24,
+        "x": 0,
+        "y": 0
+      },
+      "id": 10,
+      "options": {
+        "alertThreshold": true,
+        "legend": {
+          "calcs": [
+            "mean",
+            "max",
+            "sum"
+          ],
+          "displayMode": "table",
+          "placement": "right",
+          "showLegend": true
+        },
+        "tooltip": {
+          "mode": "multi",
+          "sort": "none"
+        }
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "alias": "Info",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "info"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Notice",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "B",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "notice"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Warning",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "D",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "warning"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Error",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "C",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "err"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Critical",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "E",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "crit"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Alert",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "F",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "alert"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        },
+        {
+          "alias": "Emergency",
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "1m"
+              ],
+              "type": "time"
+            },
+            {
+              "params": [
+                "null"
+              ],
+              "type": "fill"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "G",
+          "resultFormat": "time_series",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              },
+              {
+                "params": [],
+                "type": "count"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "severity",
+              "operator": "=",
+              "value": "emerg"
+            },
+            {
+              "condition": "AND",
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "title": "syslog count",
+      "type": "timeseries"
+    },
+    {
+      "datasource": {
+        "type": "influxdb",
+        "uid": "PDD5124384626356D"
+      },
+      "description": "",
+      "fieldConfig": {
+        "defaults": {
+          "color": {
+            "mode": "thresholds"
+          },
+          "custom": {
+            "align": "left",
+            "cellOptions": {
+              "type": "auto"
+            },
+            "filterable": false,
+            "inspect": false
+          },
+          "mappings": [],
+          "thresholds": {
+            "mode": "absolute",
+            "steps": [
+              {
+                "color": "dark-purple",
+                "value": null
+              },
+              {
+                "color": "dark-red",
+                "value": 2
+              },
+              {
+                "color": "dark-orange",
+                "value": 3
+              },
+              {
+                "color": "dark-yellow",
+                "value": 4
+              },
+              {
+                "color": "rgb(150, 150, 150)",
+                "value": 5
+              },
+              {
+                "color": "rgb(51, 51, 51)",
+                "value": 6
+              },
+              {
+                "color": "rgb(5, 5, 5)",
+                "value": 7
+              }
+            ]
+          }
+        },
+        "overrides": [
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "severity_code"
+            },
+            "properties": [
+              {
+                "id": "mappings",
+                "value": [
+                  {
+                    "options": {
+                      "0": {
+                        "text": "Emergency"
+                      },
+                      "1": {
+                        "text": "Alert"
+                      },
+                      "2": {
+                        "text": "Critical"
+                      },
+                      "3": {
+                        "text": "Error"
+                      },
+                      "4": {
+                        "text": "Warning"
+                      },
+                      "5": {
+                        "text": "Notice"
+                      },
+                      "6": {
+                        "text": "Info"
+                      },
+                      "7": {
+                        "text": "Debug"
+                      }
+                    },
+                    "type": "value"
+                  }
+                ]
+              },
+              {
+                "id": "custom.cellOptions",
+                "value": {
+                  "mode": "gradient",
+                  "type": "color-background"
+                }
+              },
+              {
+                "id": "custom.width",
+                "value": 119
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "Time"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 163
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "hostname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 194
+              }
+            ]
+          },
+          {
+            "matcher": {
+              "id": "byName",
+              "options": "appname"
+            },
+            "properties": [
+              {
+                "id": "custom.width",
+                "value": 264
+              }
+            ]
+          }
+        ]
+      },
+      "gridPos": {
+        "h": 24,
+        "w": 24,
+        "x": 0,
+        "y": 7
+      },
+      "id": 12,
+      "options": {
+        "cellHeight": "sm",
+        "footer": {
+          "countRows": false,
+          "fields": "",
+          "reducer": [
+            "sum"
+          ],
+          "show": false
+        },
+        "showHeader": true,
+        "sortBy": [
+          {
+            "desc": true,
+            "displayName": "Time"
+          }
+        ]
+      },
+      "pluginVersion": "11.4.0",
+      "targets": [
+        {
+          "datasource": {
+            "type": "influxdb",
+            "uid": "PDD5124384626356D"
+          },
+          "groupBy": [
+            {
+              "params": [
+                "hostname"
+              ],
+              "type": "tag"
+            },
+            {
+              "params": [
+                "appname"
+              ],
+              "type": "tag"
+            }
+          ],
+          "measurement": "syslog",
+          "orderByTime": "ASC",
+          "policy": "default",
+          "refId": "A",
+          "resultFormat": "table",
+          "select": [
+            [
+              {
+                "params": [
+                  "severity_code"
+                ],
+                "type": "field"
+              }
+            ],
+            [
+              {
+                "params": [
+                  "message"
+                ],
+                "type": "field"
+              }
+            ]
+          ],
+          "tags": [
+            {
+              "key": "hostname",
+              "operator": "=~",
+              "value": "/^$hostname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "appname",
+              "operator": "=~",
+              "value": "/^$appname$/"
+            },
+            {
+              "condition": "AND",
+              "key": "severity",
+              "operator": "=~",
+              "value": "/^$severity$/"
+            },
+            {
+              "condition": "AND",
+              "key": "message",
+              "operator": "=~",
+              "value": "/$Query/"
+            }
+          ]
+        }
+      ],
+      "title": "Syslog Messages",
+      "type": "table"
+    }
+  ],
+  "preload": false,
+  "refresh": "5s",
+  "schemaVersion": 40,
+  "tags": [],
+  "templating": {
+    "list": [
+      {
+        "current": {
+          "text": "All",
+          "value": [
+            "$__all"
+          ]
+        },
+        "datasource": "PDD5124384626356D",
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "includeAll": true,
+        "label": "Appname",
+        "multi": true,
+        "name": "appname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=appname",
+        "refresh": 2,
+        "regex": "",
+        "sort": 1,
+        "type": "query"
+      },
+      {
+        "current": {
+          "text": "All",
+          "value": [
+            "$__all"
+          ]
+        },
+        "datasource": "PDD5124384626356D",
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "includeAll": true,
+        "label": "Hostname",
+        "multi": true,
+        "name": "hostname",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=hostname",
+        "refresh": 2,
+        "regex": "",
+        "sort": 1,
+        "type": "query"
+      },
+      {
+        "current": {
+          "text": "All",
+          "value": [
+            "$__all"
+          ]
+        },
+        "datasource": "PDD5124384626356D",
+        "definition": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "includeAll": true,
+        "label": "Severity",
+        "multi": true,
+        "name": "severity",
+        "options": [],
+        "query": "SHOW TAG VALUES FROM syslog WITH KEY=severity",
+        "refresh": 2,
+        "regex": "",
+        "type": "query"
+      },
+      {
+        "current": {
+          "text": "",
+          "value": ""
+        },
+        "description": "Querystring",
+        "label": "MessageQuery",
+        "name": "Query",
+        "options": [
+          {
+            "selected": true,
+            "text": "",
+            "value": ""
+          }
+        ],
+        "query": "",
+        "type": "textbox"
+      }
+    ]
+  },
+  "time": {
+    "from": "now-1h",
+    "to": "now"
+  },
+  "timepicker": {
+    "refresh_intervals": [
+      "5s",
+      " 10s",
+      " 30s",
+      " 1m",
+      " 5m"
+    ]
+  },
+  "timezone": "",
+  "title": "Syslog",
+  "uid": "TIYeHqRgZ",
+  "version": 2,
+  "weekStart": ""
+}
\ No newline at end of file

changed: [7uu13-3] => (item=syslog)

TASK [grafana : Create Grafana Container] **************************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "exists": false,
-    "running": false
+    "exists": true,
+    "running": true
 }

changed: [7uu13-3]

TASK [Add Grafana CNAME record] ************************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-3]

RUNNING HANDLER [grafana : Restart Grafana Container] **************************
--- before
+++ after
@@ -1,4 +1,4 @@
 {
-    "restarted": false,
+    "restarted": true,
     "running": true
 }

changed: [7uu13-3]

PLAY [Install Influxdb] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [influxdb : download InfluxDB GPG keys] ***********************************
changed: [7uu13-3]

TASK [influxdb : add InfluxDB repository] **************************************
--- before: /dev/null
+++ after: /etc/apt/sources.list.d/influxdb.list
@@ -0,0 +1 @@
+deb https://repos.influxdata.com/ubuntu stable main

changed: [7uu13-3]

TASK [influxdb : install InfluxDB and telegraf] ********************************
The following NEW packages will be installed:
  influxdb telegraf
0 upgraded, 2 newly installed, 0 to remove and 129 not upgraded.
changed: [7uu13-3]

TASK [influxdb : Configure Telegraf] *******************************************
diff skipped: destination file size is greater than 104448
changed: [7uu13-3]

TASK [influxdb : Ensure that influx and telegraf are enabled and running] ******
changed: [7uu13-3] => (item=influxd)
changed: [7uu13-3] => (item=telegraf)

TASK [influxdb : Install Influx stats exporter] ********************************
changed: [7uu13-3]

TASK [influxdb : Create service file for influx stats exporter] ****************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpbtbvu6uj/influx_stats_exporter.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Exporter for influxdb stats
+After=network-online.target
+
+[Service]
+User=prometheus
+ExecStart=/usr/local/bin/influx_stats_exporter
+Restart=on-failure
+
+[Install]
+WantedBy=multi-user.target
\ No newline at end of file

changed: [7uu13-3]

TASK [influxdb : Ensure influx stats exporter is enabled and running] **********
changed: [7uu13-3]

TASK [influxdb : Create a backup directory] ************************************
--- before
+++ after
@@ -1,7 +1,7 @@
 {
-    "group": 0,
-    "mode": "0755",
-    "owner": 0,
+    "group": 34,
+    "mode": "0775",
+    "owner": 34,
     "path": "/home/backup/influxdb",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-3]

TASK [influxdb : copy influxdb backup cron job] ********************************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmphp3gtooe/influxdb_cron.j2
@@ -0,0 +1,2 @@
+0 * * * *    backup rm -rf /home/backup/influxdb/*; influxd backup -portable -db telegraf /home/backup/influxdb                                            
+0 12 * * *  backup  duplicity --no-encryption full /home/backup/influxdb rsync://7uu13@backup/influxdb                                                

changed: [7uu13-3]

TASK [Add InfluxDB CNAME record] ***********************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
changed: [7uu13-3]

RUNNING HANDLER [influxdb : Restart telegraf] **********************************
changed: [7uu13-3]

RUNNING HANDLER [influxdb : Restart influx_stats_exporter] *********************
changed: [7uu13-3]

RUNNING HANDLER [influxdb : Reload systemd] ************************************
ok: [7uu13-3]

PLAY [Install agama-client to vm2] *********************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [agama_client : Install fping] ********************************************
The following NEW packages will be installed:
  fping
0 upgraded, 1 newly installed, 0 to remove and 130 not upgraded.
changed: [7uu13-3]

TASK [agama_client : Create user agama-client] *********************************
changed: [7uu13-3]

TASK [agama_client : Download agama-client configuration] **********************
changed: [7uu13-3]

TASK [agama_client : Create service file for agama-client] *********************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmpynbj0wyn/agama-client.service.j2
@@ -0,0 +1,11 @@
+[Unit]
+Description=Agama client
+After=network-online.target
+
+[Service]
+User=agama-client
+ExecStart=/usr/local/bin/agama-client
+Restart=on-failure
+
+[Install]
+WantedBy=multi-user.target

changed: [7uu13-3]

TASK [agama_client : Flush handlers] *******************************************

RUNNING HANDLER [agama_client : reload system daemon] **************************
ok: [7uu13-3]

RUNNING HANDLER [agama_client : Restart agama-client] **************************
changed: [7uu13-3]

TASK [agama_client : Ensure /etc/agama-client directory exists] ****************
--- before
+++ after
@@ -1,6 +1,6 @@
 {
-    "group": 0,
-    "owner": 0,
+    "group": 996,
+    "owner": 996,
     "path": "/etc/agama-client",
-    "state": "absent"
+    "state": "directory"
 }

changed: [7uu13-3]

TASK [agama_client : Add agama-client configuration file] **********************
--- before
+++ after: /home/johan/.ansible/tmp/ansible-local-203786cdb12fx4/tmp09et4fck/agama-client.conf.j2
@@ -0,0 +1,3 @@
+database_url=http://influxdb.lockbox.sec:8086
+database_name=agama_stats
+subnet=192.168.42.0/23

changed: [7uu13-3]

TASK [agama_client : Ensure agama_client service is started and enabled] *******
changed: [7uu13-3]

RUNNING HANDLER [agama_client : Restart agama-client] **************************
changed: [7uu13-3]

PLAY RECAP *********************************************************************
7uu13-1                    : ok=88   changed=68   unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
7uu13-2                    : ok=88   changed=68   unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
7uu13-3                    : ok=93   changed=67   unreachable=0    failed=0    skipped=0    rescued=0    ignored=0   

+ ansible-playbook infra.yaml --diff

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]
ok: [7uu13-1]
ok: [7uu13-2]

TASK [init : get variables] ****************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Update APT Cache] *************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Add user named Juri] **********************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Add user named Roman] *********************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Add ssh key for user Juri] ****************************************
ok: [7uu13-2]
ok: [7uu13-3]
ok: [7uu13-1]

TASK [init : Add ssh key for user Roman] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : install Nginx node exporter] **************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Configure rsyslog] ************************************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [init : Ensure influx and telegraf are enabled and running] ***************
ok: [7uu13-3] => (item=prometheus-node-exporter)
ok: [7uu13-2] => (item=prometheus-node-exporter)
ok: [7uu13-1] => (item=prometheus-node-exporter)
ok: [7uu13-3] => (item=rsyslog)
ok: [7uu13-2] => (item=rsyslog)
ok: [7uu13-1] => (item=rsyslog)

TASK [init : Add user named backup] ********************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Configure known_hosts file] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Create a restore directory] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Install duplicity] ************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

PLAY [DNS Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [bind : Gather facts] *****************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Install bind9] ****************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Configure Bind9] **************************************************
ok: [7uu13-1] => (item=None)
ok: [7uu13-2] => (item=None)
ok: [7uu13-3] => (item=None)
ok: [7uu13-2] => (item=None)
ok: [7uu13-2]
ok: [7uu13-1] => (item=None)
ok: [7uu13-1]
ok: [7uu13-3] => (item=None)
ok: [7uu13-3]

TASK [bind : Configure DNS Master and Reverse Zone] ****************************
skipping: [7uu13-1] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'}) 
skipping: [7uu13-1] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'}) 
skipping: [7uu13-1]
skipping: [7uu13-2] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'}) 
skipping: [7uu13-2] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'}) 
skipping: [7uu13-2]
ok: [7uu13-3] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'})
ok: [7uu13-3] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'})

TASK [bind : Ensure bind9 service is started and enabled] **********************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Add A Records] ****************************************************
skipping: [7uu13-1] => (item=None) 
skipping: [7uu13-1]
skipping: [7uu13-2] => (item=None) 
skipping: [7uu13-2]
ok: [7uu13-3] => (item=None)
ok: [7uu13-3]

TASK [Add both Slave Bind CNAME records] ***************************************
included: dns_record for 7uu13-3, 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Download Bind9 exporter archive] **********************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [bind : Extract Bind9 exporter archive] ***********************************
skipping: [7uu13-3]
skipping: [7uu13-1]
skipping: [7uu13-2]

TASK [bind : Create symbolic link to prometheus-bind-exporter] *****************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Create systemd service definition] ********************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Ensure bind exporter service is started and enabled] **************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

PLAY [Configure resolv.conf on all machines] ***********************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [resolver : Gather facts] *************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [resolver : Stop and Disable systemd-resolevd] ****************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [resolver : Configure resolv.conf] ****************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

PLAY [Database Server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Install MySql] ***************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Override Default Bind-Addr] **************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Create a new database with name 'agama'] *************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Create a new user with name 'agama'] *****************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Create a new user with name 'replication'] ***********************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Install prometheus-mysqld-exporter] ******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Configure my.cnf for prometheus node exporter] *******************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Ensure that Mysql and it's exporter service are started and enabled] ***
ok: [7uu13-2] => (item=mysql)
ok: [7uu13-1] => (item=mysql)

TASK [mysql : Create a new user with name 'exporter'] **************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Create a backup directory] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Add user named 'backup' to mysql] ********************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Add my.cnf conf for user backup] *********************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Turn on Read only on the slave node] *****************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [Add both Mysql CNAME records] ********************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Configure Cron for backups] **************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Ensure that prometheus node exporter is running] *****************
ok: [7uu13-1]
ok: [7uu13-2]

PLAY [Web Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-1] => (item=nginx)
ok: [7uu13-2] => (item=nginx)
ok: [7uu13-1] => (item=prometheus-nginx-exporter)
ok: [7uu13-2] => (item=prometheus-nginx-exporter)

TASK [docker : Install Docker] *************************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [docker : Add ubuntu to docker group] *************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [docker : Ensure Docker service is started] *******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [agama : Add folder for Agama and assign it correct permissions] **********
ok: [7uu13-1]
ok: [7uu13-2]

TASK [agama : Install Agama source and it's Dockerfile] ************************
ok: [7uu13-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [7uu13-2] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [7uu13-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/refs/heads/master/Dockerfile)
ok: [7uu13-2] => (item=https://raw.githubusercontent.com/hudolejev/agama/refs/heads/master/Dockerfile)

TASK [agama : Build Agama Container] *******************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [agama : Create Agama Container] ******************************************
ok: [7uu13-1] => (item=None)
ok: [7uu13-2] => (item=None)
ok: [7uu13-1] => (item=None)
ok: [7uu13-1]
ok: [7uu13-2] => (item=None)
ok: [7uu13-2]

TASK [Add both Agama CNAME records] ********************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Install HaProxy] ***********************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Configure HaProxy] *********************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Install haproxy node exporter] *********************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Configure haproxy node exporter] *******************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Ensure that haproxy and its exporter are running and enabled] ***
ok: [7uu13-1] => (item=haproxy)
ok: [7uu13-2] => (item=haproxy)
ok: [7uu13-1] => (item=prometheus-haproxy-exporter)
ok: [7uu13-2] => (item=prometheus-haproxy-exporter)

TASK [Add both Haproxy CNAME records] ******************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [keepalived : Install Keepalived] *****************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [keepalived : Configure Keepalived] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [keepalived : Install keepalived node exporter] ***************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [keepalived : Install the downloaded keepalived exporter .deb file] *******
ok: [7uu13-2]
ok: [7uu13-1]

TASK [keepalived : Create service file for keepalived exporter] ****************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [keepalived : Ensure that Keepalived and its exporter are enabled and running] ***
ok: [7uu13-2] => (item=keepalived)
ok: [7uu13-1] => (item=keepalived)
ok: [7uu13-1] => (item=keepalived-exporter)
ok: [7uu13-2] => (item=keepalived-exporter)

PLAY [Install and configure prometheus] ****************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-3]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-3]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-3]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-3] => (item=nginx)
ok: [7uu13-3] => (item=prometheus-nginx-exporter)

TASK [prometheus : Install Prometheus] *****************************************
ok: [7uu13-3]

TASK [prometheus : Configure Prometheus] ***************************************
ok: [7uu13-3]

TASK [prometheus : Ensure Prometheus service is started and enabled] ***********
ok: [7uu13-3]

TASK [prometheus : Configure /etc/default for prometheus] **********************
ok: [7uu13-3]

TASK [Add Prometheus CNAME record] *********************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]

PLAY [Install and configure Grafana] *******************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [docker : Install Docker] *************************************************
ok: [7uu13-3]

TASK [docker : Add ubuntu to docker group] *************************************
ok: [7uu13-3]

TASK [docker : Ensure Docker service is started] *******************************
ok: [7uu13-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-3]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-3]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-3]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-3] => (item=nginx)
ok: [7uu13-3] => (item=prometheus-nginx-exporter)

TASK [grafana : Create Grafana directory] **************************************
ok: [7uu13-3] => (item=dashboards)
ok: [7uu13-3] => (item=datasources)

TASK [grafana : Add grafana.ini] ***********************************************
ok: [7uu13-3]

TASK [grafana : Add default dashboard and datasources] *************************
ok: [7uu13-3] => (item=datasources)
ok: [7uu13-3] => (item=dashboards)

TASK [grafana : Add dashboards] ************************************************
ok: [7uu13-3] => (item=main)
ok: [7uu13-3] => (item=backups)
ok: [7uu13-3] => (item=mysql)
ok: [7uu13-3] => (item=syslog)

TASK [grafana : Create Grafana Container] **************************************
ok: [7uu13-3]

TASK [Add Grafana CNAME record] ************************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]

PLAY [Install Influxdb] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [influxdb : download InfluxDB GPG keys] ***********************************
ok: [7uu13-3]

TASK [influxdb : add InfluxDB repository] **************************************
ok: [7uu13-3]

TASK [influxdb : install InfluxDB and telegraf] ********************************
ok: [7uu13-3]

TASK [influxdb : Configure Telegraf] *******************************************
ok: [7uu13-3]

TASK [influxdb : Ensure that influx and telegraf are enabled and running] ******
ok: [7uu13-3] => (item=influxd)
ok: [7uu13-3] => (item=telegraf)

TASK [influxdb : Install Influx stats exporter] ********************************
ok: [7uu13-3]

TASK [influxdb : Create service file for influx stats exporter] ****************
ok: [7uu13-3]

TASK [influxdb : Ensure influx stats exporter is enabled and running] **********
ok: [7uu13-3]

TASK [influxdb : Create a backup directory] ************************************
ok: [7uu13-3]

TASK [influxdb : copy influxdb backup cron job] ********************************
ok: [7uu13-3]

TASK [Add InfluxDB CNAME record] ***********************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]

PLAY [Install agama-client to vm2] *********************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [agama_client : Install fping] ********************************************
ok: [7uu13-3]

TASK [agama_client : Create user agama-client] *********************************
ok: [7uu13-3]

TASK [agama_client : Download agama-client configuration] **********************
ok: [7uu13-3]

TASK [agama_client : Create service file for agama-client] *********************
ok: [7uu13-3]

TASK [agama_client : Flush handlers] *******************************************

TASK [agama_client : Ensure /etc/agama-client directory exists] ****************
ok: [7uu13-3]

TASK [agama_client : Add agama-client configuration file] **********************
ok: [7uu13-3]

TASK [agama_client : Ensure agama_client service is started and enabled] *******
ok: [7uu13-3]

PLAY RECAP *********************************************************************
7uu13-1                    : ok=74   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
7uu13-2                    : ok=74   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
7uu13-3                    : ok=78   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ ansible all -b -m reboot -a test_command=uptime
7uu13-3 | CHANGED => {
    "changed": true,
    "elapsed": 33,
    "rebooted": true
}
7uu13-2 | CHANGED => {
    "changed": true,
    "elapsed": 43,
    "rebooted": true
}
7uu13-1 | CHANGED => {
    "changed": true,
    "elapsed": 44,
    "rebooted": true
}
+ sleep 15
+ ansible-playbook infra.yaml --diff

PLAY [Init] ********************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [init : get variables] ****************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Update APT Cache] *************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Add user named Juri] **********************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Add user named Roman] *********************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Add ssh key for user Juri] ****************************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [init : Add ssh key for user Roman] ***************************************
ok: [7uu13-3]
ok: [7uu13-1]
ok: [7uu13-2]

TASK [init : install Nginx node exporter] **************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Configure rsyslog] ************************************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [init : Ensure influx and telegraf are enabled and running] ***************
ok: [7uu13-2] => (item=prometheus-node-exporter)
ok: [7uu13-3] => (item=prometheus-node-exporter)
ok: [7uu13-1] => (item=prometheus-node-exporter)
ok: [7uu13-2] => (item=rsyslog)
ok: [7uu13-3] => (item=rsyslog)
ok: [7uu13-1] => (item=rsyslog)

TASK [init : Add user named backup] ********************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Configure known_hosts file] ***************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Create a restore directory] ***************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [init : Install duplicity] ************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

PLAY [DNS Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-3]
ok: [7uu13-1]

TASK [bind : Gather facts] *****************************************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [bind : Install bind9] ****************************************************
ok: [7uu13-2]
ok: [7uu13-3]
ok: [7uu13-1]

TASK [bind : Configure Bind9] **************************************************
ok: [7uu13-2] => (item=None)
ok: [7uu13-1] => (item=None)
ok: [7uu13-3] => (item=None)
ok: [7uu13-2] => (item=None)
ok: [7uu13-2]
ok: [7uu13-1] => (item=None)
ok: [7uu13-1]
ok: [7uu13-3] => (item=None)
ok: [7uu13-3]

TASK [bind : Configure DNS Master and Reverse Zone] ****************************
skipping: [7uu13-1] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'}) 
skipping: [7uu13-1] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'}) 
skipping: [7uu13-1]
skipping: [7uu13-2] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'}) 
skipping: [7uu13-2] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'}) 
skipping: [7uu13-2]
ok: [7uu13-3] => (item={'src': 'db.lockbox.sec.j2', 'dest': '/var/cache/bind/db.lockbox.sec'})
ok: [7uu13-3] => (item={'src': 'db.lockbox.sec.rev.j2', 'dest': '/var/cache/bind/db.lockbox.sec.rev'})

TASK [bind : Ensure bind9 service is started and enabled] **********************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Flush handlers] ***************************************************

TASK [bind : Add A Records] ****************************************************
skipping: [7uu13-1] => (item=None) 
skipping: [7uu13-1]
skipping: [7uu13-2] => (item=None) 
skipping: [7uu13-2]
ok: [7uu13-3] => (item=None)
ok: [7uu13-3]

TASK [Add both Slave Bind CNAME records] ***************************************
included: dns_record for 7uu13-3, 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]
ok: [7uu13-1]
ok: [7uu13-2]

TASK [bind : Download Bind9 exporter archive] **********************************
ok: [7uu13-3]
ok: [7uu13-2]
ok: [7uu13-1]

TASK [bind : Extract Bind9 exporter archive] ***********************************
skipping: [7uu13-3]
skipping: [7uu13-1]
skipping: [7uu13-2]

TASK [bind : Create symbolic link to prometheus-bind-exporter] *****************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [bind : Create systemd service definition] ********************************
ok: [7uu13-1]
ok: [7uu13-2]
ok: [7uu13-3]

TASK [bind : Ensure bind exporter service is started and enabled] **************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

PLAY [Configure resolv.conf on all machines] ***********************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [resolver : Gather facts] *************************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

TASK [resolver : Stop and Disable systemd-resolevd] ****************************
ok: [7uu13-1]
ok: [7uu13-3]
ok: [7uu13-2]

TASK [resolver : Configure resolv.conf] ****************************************
ok: [7uu13-2]
ok: [7uu13-1]
ok: [7uu13-3]

PLAY [Database Server] *********************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Install MySql] ***************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Override Default Bind-Addr] **************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Create a new database with name 'agama'] *************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Create a new user with name 'agama'] *****************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Create a new user with name 'replication'] ***********************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Install prometheus-mysqld-exporter] ******************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Configure my.cnf for prometheus node exporter] *******************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Ensure that Mysql and it's exporter service are started and enabled] ***
ok: [7uu13-1] => (item=mysql)
ok: [7uu13-2] => (item=mysql)

TASK [mysql : Create a new user with name 'exporter'] **************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Create a backup directory] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Add user named 'backup' to mysql] ********************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Add my.cnf conf for user backup] *********************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Turn on Read only on the slave node] *****************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [Add both Mysql CNAME records] ********************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [mysql : Configure Cron for backups] **************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [mysql : Ensure that prometheus node exporter is running] *****************
ok: [7uu13-1]
ok: [7uu13-2]

PLAY [Web Server] **************************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-2] => (item=nginx)
ok: [7uu13-1] => (item=nginx)
ok: [7uu13-2] => (item=prometheus-nginx-exporter)
ok: [7uu13-1] => (item=prometheus-nginx-exporter)

TASK [docker : Install Docker] *************************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [docker : Add ubuntu to docker group] *************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [docker : Ensure Docker service is started] *******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [agama : Add folder for Agama and assign it correct permissions] **********
ok: [7uu13-2]
ok: [7uu13-1]

TASK [agama : Install Agama source and it's Dockerfile] ************************
ok: [7uu13-2] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [7uu13-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/master/agama.py)
ok: [7uu13-2] => (item=https://raw.githubusercontent.com/hudolejev/agama/refs/heads/master/Dockerfile)
ok: [7uu13-1] => (item=https://raw.githubusercontent.com/hudolejev/agama/refs/heads/master/Dockerfile)

TASK [agama : Build Agama Container] *******************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [agama : Create Agama Container] ******************************************
ok: [7uu13-1] => (item=None)
ok: [7uu13-2] => (item=None)
ok: [7uu13-1] => (item=None)
ok: [7uu13-1]
ok: [7uu13-2] => (item=None)
ok: [7uu13-2]

TASK [Add both Agama CNAME records] ********************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Install HaProxy] ***********************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [haproxy : Configure HaProxy] *********************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Install haproxy node exporter] *********************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [haproxy : Configure haproxy node exporter] *******************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [haproxy : Ensure that haproxy and its exporter are running and enabled] ***
ok: [7uu13-1] => (item=haproxy)
ok: [7uu13-2] => (item=haproxy)
ok: [7uu13-1] => (item=prometheus-haproxy-exporter)
ok: [7uu13-2] => (item=prometheus-haproxy-exporter)

TASK [Add both Haproxy CNAME records] ******************************************
included: dns_record for 7uu13-1, 7uu13-2

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [keepalived : Install Keepalived] *****************************************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [keepalived : Configure Keepalived] ***************************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [keepalived : Install keepalived node exporter] ***************************
ok: [7uu13-1]
ok: [7uu13-2]

TASK [keepalived : Install the downloaded keepalived exporter .deb file] *******
ok: [7uu13-2]
ok: [7uu13-1]

TASK [keepalived : Create service file for keepalived exporter] ****************
ok: [7uu13-2]
ok: [7uu13-1]

TASK [keepalived : Ensure that Keepalived and its exporter are enabled and running] ***
ok: [7uu13-2] => (item=keepalived)
ok: [7uu13-1] => (item=keepalived)
ok: [7uu13-2] => (item=keepalived-exporter)
ok: [7uu13-1] => (item=keepalived-exporter)

PLAY [Install and configure prometheus] ****************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-3]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-3]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-3]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-3] => (item=nginx)
ok: [7uu13-3] => (item=prometheus-nginx-exporter)

TASK [prometheus : Install Prometheus] *****************************************
ok: [7uu13-3]

TASK [prometheus : Configure Prometheus] ***************************************
ok: [7uu13-3]

TASK [prometheus : Ensure Prometheus service is started and enabled] ***********
ok: [7uu13-3]

TASK [prometheus : Configure /etc/default for prometheus] **********************
ok: [7uu13-3]

TASK [Add Prometheus CNAME record] *********************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]

PLAY [Install and configure Grafana] *******************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [docker : Install Docker] *************************************************
ok: [7uu13-3]

TASK [docker : Add ubuntu to docker group] *************************************
ok: [7uu13-3]

TASK [docker : Ensure Docker service is started] *******************************
ok: [7uu13-3]

TASK [nginx : Install Nginx] ***************************************************
ok: [7uu13-3]

TASK [nginx : Copy local Nginx configuration file] *****************************
ok: [7uu13-3]

TASK [nginx : Flush nginx handlers] ********************************************

TASK [nginx : Install Prometheus Nginx Exporter] *******************************
ok: [7uu13-3]

TASK [nginx : Ensure that both nginx and nginx exporter services are enabled and started] ***
ok: [7uu13-3] => (item=nginx)
ok: [7uu13-3] => (item=prometheus-nginx-exporter)

TASK [grafana : Create Grafana directory] **************************************
ok: [7uu13-3] => (item=dashboards)
ok: [7uu13-3] => (item=datasources)

TASK [grafana : Add grafana.ini] ***********************************************
ok: [7uu13-3]

TASK [grafana : Add default dashboard and datasources] *************************
ok: [7uu13-3] => (item=datasources)
ok: [7uu13-3] => (item=dashboards)

TASK [grafana : Add dashboards] ************************************************
ok: [7uu13-3] => (item=main)
ok: [7uu13-3] => (item=backups)
ok: [7uu13-3] => (item=mysql)
ok: [7uu13-3] => (item=syslog)

TASK [grafana : Create Grafana Container] **************************************
ok: [7uu13-3]

TASK [Add Grafana CNAME record] ************************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]

PLAY [Install Influxdb] ********************************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [influxdb : download InfluxDB GPG keys] ***********************************
ok: [7uu13-3]

TASK [influxdb : add InfluxDB repository] **************************************
ok: [7uu13-3]

TASK [influxdb : install InfluxDB and telegraf] ********************************
ok: [7uu13-3]

TASK [influxdb : Configure Telegraf] *******************************************
ok: [7uu13-3]

TASK [influxdb : Ensure that influx and telegraf are enabled and running] ******
ok: [7uu13-3] => (item=influxd)
ok: [7uu13-3] => (item=telegraf)

TASK [influxdb : Install Influx stats exporter] ********************************
ok: [7uu13-3]

TASK [influxdb : Create service file for influx stats exporter] ****************
ok: [7uu13-3]

TASK [influxdb : Ensure influx stats exporter is enabled and running] **********
ok: [7uu13-3]

TASK [influxdb : Create a backup directory] ************************************
ok: [7uu13-3]

TASK [influxdb : copy influxdb backup cron job] ********************************
ok: [7uu13-3]

TASK [Add InfluxDB CNAME record] ***********************************************
included: dns_record for 7uu13-3

TASK [dns_record : create CNAME record for local machine] **********************
ok: [7uu13-3]

PLAY [Install agama-client to vm2] *********************************************

TASK [Gathering Facts] *********************************************************
ok: [7uu13-3]

TASK [agama_client : Install fping] ********************************************
ok: [7uu13-3]

TASK [agama_client : Create user agama-client] *********************************
ok: [7uu13-3]

TASK [agama_client : Download agama-client configuration] **********************
ok: [7uu13-3]

TASK [agama_client : Create service file for agama-client] *********************
ok: [7uu13-3]

TASK [agama_client : Flush handlers] *******************************************

TASK [agama_client : Ensure /etc/agama-client directory exists] ****************
ok: [7uu13-3]

TASK [agama_client : Add agama-client configuration file] **********************
ok: [7uu13-3]

TASK [agama_client : Ensure agama_client service is started and enabled] *******
ok: [7uu13-3]

PLAY RECAP *********************************************************************
7uu13-1                    : ok=74   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
7uu13-2                    : ok=74   changed=0    unreachable=0    failed=0    skipped=3    rescued=0    ignored=0   
7uu13-3                    : ok=78   changed=0    unreachable=0    failed=0    skipped=1    rescued=0    ignored=0   

+ date
Wed Dec 18 04:37:06 PM EET 2024
